<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>تحليل أحياء حلب</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <!-- Leaflet MarkerCluster CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
    />

    <!-- Leaflet Draw CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"
    />

    <!-- Animate.css for animations -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <!-- Application CSS -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/tabs.css" />
    <link rel="stylesheet" href="css/map_v2.css" />
    <link rel="stylesheet" href="css/auto-close.css" />
    <link rel="stylesheet" href="css/tabs-toggle.css" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Cairo", sans-serif;
        box-sizing: border-box;
        overflow: hidden;
      }

      /* Fixed positioning for header and footer regardless of language direction */
      .no-translate {
        position: fixed !important;
        width: 100% !important;
        left: 0 !important;
        right: 0 !important;
      }

      /* Ensure elements inside no-translate containers maintain their position */
      .no-translate * {
        direction: inherit !important;
      }

      /* Override direction for specific elements that need to be translated */
      .no-translate .language-dropdown,
      .no-translate .menu-dropdown-content {
        direction: auto;
      }

      /* Ensure header elements maintain their positions - reversed order */
      #mainHeader .header-logos.right-logos {
        position: absolute !important;
        left: 20px !important;
        right: auto !important;
      }

      #mainHeader > div:first-child {
        position: absolute !important;
        right: 20px !important;
        left: auto !important;
      }

      #mainHeader .header-title {
        position: absolute !important;
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%) !important;
        width: auto !important;
        text-align: center !important;
      }

      /* Make both titles visible in the header */
      #mainHeader .title-ar,
      #mainHeader .title-en {
        display: block !important;
      }

      /* Improve appearance of titles in header */
      #mainHeader .header-title {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
      }

      #mainHeader .title-ar {
        font-size: 1.1rem !important;
        margin-bottom: 2px !important;
      }

      #mainHeader .title-en {
        font-size: 0.9rem !important;
        opacity: 0.9 !important;
      }

      /* Ensure footer elements maintain their positions - reversed order */
      #mainFooter .copyright {
        position: absolute !important;
        right: 20px !important;
        left: auto !important;
      }

      #mainFooter .social-icons {
        position: absolute !important;
        left: 20px !important;
        right: auto !important;
      }

      /* Fix for RTL/LTR switching */
      body[dir="ltr"] #mainHeader .header-logos.right-logos,
      body[dir="ltr"] #mainFooter .social-icons {
        right: 20px !important;
        left: auto !important;
      }

      body[dir="ltr"] #mainHeader > div:first-child,
      body[dir="ltr"] #mainFooter .copyright {
        left: 20px !important;
        right: auto !important;
      }

      body[dir="rtl"] #mainHeader .header-logos.right-logos,
      body[dir="rtl"] #mainFooter .social-icons {
        left: 20px !important;
        right: auto !important;
      }

      body[dir="rtl"] #mainHeader > div:first-child,
      body[dir="rtl"] #mainFooter .copyright {
        right: 20px !important;
        left: auto !important;
      }

      #mainHeader {
        position: fixed;
        top: 0;
        width: 100%;
        height: 50px;
        /* Adjust as needed */
        background: #00b2e3;
        color: white;
        z-index: 1000;
        display: flex;
        align-items: center;
      }

      #mainFooter {
        position: fixed;
        bottom: 0;
        width: 100%;
        height: 50px;
        background: #00b2e3;
        color: white;
        z-index: 2000; /* أقل من التبويبات */
        display: flex;
        align-items: center;
      }

      .mainContent {
        /* position: absolute; */
        margin-top: 100px;
        left: 0;
        right: 0;
        bottom: 70px;
        width: 100%;
        overflow: hidden;
        background: #fff;
        box-sizing: border-box;
        display: flex;
        margin: 0;
        padding: 0;
      }

      .main-content {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 0;
      }

      .map-container {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #map {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      /* Responsive adjustments if needed */
      @media (max-width: 600px) {
        #mainHeader,
        #mainFooter {
          height: 56px;
          font-size: 1rem;
        }

        .mainContent {
          top: 56px;
          height: calc(100vh - 112px);
        }
      }

      .header-logo {
        height: 40px;
        width: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
        object-fit: contain;
      }

      .header-title {
        flex: 1;
        text-align: center;
        font-weight: bold;
        font-size: 1.2rem;
        line-height: 1.4;
      }

      .header-logos {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 5px;
      }

      .header-logos img {
        height: 40px;
        width: 40px;
        object-fit: contain;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
      }

      .title-ar {
        font-size: 1.2rem;
        line-height: 1.4;
        font-weight: bold;
        white-space: normal;
      }

      .title-en {
        font-size: 1.22rem;
        line-height: 1.4;
        font-weight: bold;
        white-space: normal;
      }

      @media (max-width: 768px) {
        .title-en {
          display: none;
        }
      }

      .language-dropdown {
        position: relative;
      }

      .dots-button {
        background: none;
        border: none;
        font-size: 22px;
        cursor: pointer;
        color: white;
        padding: 5px;
      }

      .language-menu {
        position: absolute;
        top: 100%;
        left: 0;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 6px;
        display: none;
        flex-direction: column;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 2000;
        min-width: 60px;
      }

      .language-menu div {
        padding: 8px 12px;
        cursor: pointer;
        color: #333;
        font-weight: bold;
        text-align: center;
      }

      .language-menu div:hover {
        background-color: #f1f1f1;
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 1rem;
        color: white;
      }

      .social-icon {
        color: #fff;
        font-size: 1.2rem;
        margin-left: 1rem;
        transition: color 0.3s ease;
      }

      .social-icon:hover {
        color: #3498db;
      }

      footer .copyright img {
        height: 40px;
        width: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
        background-color: white;
        padding: 2px;
        object-fit: contain;
        background-clip: content-box;
        vertical-align: middle;
        margin-right: 8px;
      }

      .footer-logo {
        height: 24px;
        margin-right: 8px;
        vertical-align: middle;
        display: inline-block !important;
      }

      .companyHITech {
        color: white !important;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .companyHITech:hover {
        color: #f0f0f0 !important;
        text-decoration: underline;
      }

      .info-panel {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        max-width: 400px;
        width: 90vw;
        max-height: 70vh;
        background: #fff;
        color: #222;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
        z-index: 1200;
        padding: 1.2rem 1.5rem 1.2rem 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.7rem;
        overflow: auto;
        transition: all 0.2s;
        display: none;
        /* Hide by default */
      }

      .info-panel.open,
      .info-panel.show {
        display: flex;
        /* Show when .open or .show is added */
      }

      .info-panel .close-btn {
        align-self: flex-end;
        cursor: pointer;
        font-size: 1.3rem;
        color: #888;
        background: none;
        border: none;
        margin-bottom: 0.5rem;
      }

      .info-panel h3 {
        margin: 0 0 0.8rem 0;
        font-size: 1.2rem;
        font-weight: bold;
        color: #1e40af;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e5e7eb;
        text-align: center;
      }

      #infoPanelContent,
      #info-content {
        flex: 1 1 auto;
        overflow-y: auto;
        min-height: 0;
      }

      /* جدول المعلومات */
      .info-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        direction: rtl;
        table-layout: fixed;
      }

      .info-table tr {
        border-bottom: 1px solid #f0f0f0;
        transition: background-color 0.2s;
      }

      .info-table tr:last-child {
        border-bottom: none;
      }

      .info-table tr:hover {
        background-color: #f8fafc;
      }

      .info-table th {
        text-align: right;
        padding: 0.75rem 0.5rem;
        font-weight: 600;
        color: #1e40af;
        background-color: #f1f5f9;
      }

      .info-table td {
        padding: 0.75rem 0.5rem;
        vertical-align: middle;
      }

      .info-table td:first-child {
        font-weight: 600;
        color: #4b5563;
        width: 40%;
        border-left: 1px solid #f0f0f0;
      }

      .info-table td:last-child {
        color: #111827;
        width: 60%;
      }

      /* أزرار لوحة المعلومات */
      .info-panel .button-group {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-top: 0.5rem;
      }

      .info-panel .button-group button {
        flex: 1;
        padding: 0.6rem 1rem;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-family: "Cairo", sans-serif;
        font-size: 0.9rem;
      }

      .info-panel #cancel-changes {
        background-color: #f3f4f6;
        color: #4b5563;
        margin-top: 20px !important;
      }

      .info-panel #save-changes {
        background-color: #1e40af;
        color: white;
      }

      .info-panel #cancel-changes:hover {
        background-color: #e5e7eb;
      }

      .info-panel #save-changes:hover {
        background-color: #1e3a8a;
      }

      /* Responsive for mobile */
      @media (max-width: 600px) {
        .info-panel {
          top: 10px;
          left: 5vw;
          right: 5vw;
          max-width: 95vw;
          max-height: 60vh;
          padding: 0.7rem 0.7rem 0.7rem 0.7rem;
          font-size: 0.95rem;
        }

        .info-panel h3 {
          font-size: 1rem;
        }

        .info-panel .button-group button {
          padding: 0.5rem 0.7rem;
          font-size: 0.8rem;
        }
      }

      /* Custom Google Maps-like layers button in bottom left */
      .leaflet-bottom.leaflet-left .leaflet-control-layers {
        margin-left: 20px;
        margin-bottom: 80px;
        /* adjust as needed for your footer */
      }

      .leaflet-control-layers {
        border: none !important;
        background: none !important;
        box-shadow: none !important;
      }

      .leaflet-control-layers-toggle {
        width: 80px !important;
        height: 80px !important;
        border-radius: 16px !important;
        background: url("assets/img/cover.jfif") center center/cover no-repeat,
          #fff !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18) !important;
        border: 1px solid #e0e0e0 !important;
        display: flex !important;
        flex-direction: column;
        align-items: flex-end;
        justify-content: flex-end;
        position: relative;
        overflow: hidden;
        padding: 0;
      }

      :root {
        --layers-text: "الطبقات";
      }

      .leaflet-control-layers-toggle::after {
        content: var(--layers-text, "الطبقات");
        display: block;
        position: absolute;
        bottom: 8px;
        left: 0;
        right: 0;
        text-align: center;
        color: #fff;
        font-size: 1.1rem;
        font-weight: bold;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7);
        pointer-events: none;
        font-family: "Cairo", sans-serif;
      }

      .leaflet-control-layers-toggle::before {
        content: "";
        display: block;
        position: absolute;
        bottom: 32px;
        left: 50%;
        transform: translateX(-50%);
        width: 32px;
        height: 32px;
        background: url('data:image/svg+xml;utf8,<svg fill="white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2L1 7l11 5 9.9-4.5L12 2zm0 7.7L3.6 7 12 3.3 20.4 7 12 9.7zm0 2.6l-8.4-3.7v2.1l8.4 3.7 8.4-3.7v-2.1l-8.4 3.7zm0 2.6l-8.4-3.7v2.1l8.4 3.7 8.4-3.7v-2.1l-8.4 3.7z"/></svg>')
          center center/contain no-repeat;
        pointer-events: none;
        opacity: 0.95;
      }

      .custom-layers-btn {
        position: absolute;
        bottom: 90px;
        left: 30px;
        width: 90px;
        height: 90px;
        border-radius: 16px;
        background: url("https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80")
            center center/cover no-repeat,
          #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        border: 1px solid #e0e0e0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        cursor: pointer;
        z-index: 1201;
        overflow: hidden;
        transition: box-shadow 0.2s, background 0.2s;
      }

      .custom-layers-btn:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.22);
      }

      .custom-layers-label {
        color: #fff;
        font-size: 1.1rem;
        font-weight: bold;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7);
        margin-bottom: 8px;
        font-family: "Cairo", sans-serif;
        pointer-events: none;
      }

      .custom-layers-icon {
        margin-bottom: 18px;
        pointer-events: none;
      }

      .custom-layers-modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.25);
        align-items: center;
        justify-content: center;
      }

      .custom-layers-modal.open {
        display: flex;
      }

      .custom-layers-modal-content {
        background: #fff;
        border-radius: 16px;
        padding: 2rem 2.5rem;
        min-width: 260px;
        max-width: 90vw;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
        position: relative;
        text-align: center;
      }

      .custom-layers-modal-close {
        position: absolute;
        top: 10px;
        left: 16px;
        font-size: 2rem;
        color: #888;
        cursor: pointer;
        font-weight: bold;
      }

      .gmaps-base-btn {
        position: absolute;
        bottom: 90px;
        left: 30px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1201;
        transition: box-shadow 0.2s, background 0.2s;
        outline: none;
      }

      .gmaps-base-btn:hover {
        background: #f5f5f5;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.22);
      }

      .gmaps-base-icon {
        pointer-events: none;
      }
    </style>
    <style>
      .hero {
        position: relative;
        height: 100vh;
        color: #fff;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        background-color: #1e293b;
      }

      #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      .hero-content {
        position: relative;
        z-index: 2;
        max-width: 800px;
        padding: 2rem;
      }

      .hero-subtitle {
        font-size: 1.25rem;
        margin-bottom: 2rem;
        line-height: 1.8;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        margin: 0.5rem;
        border-radius: 50px;
        font-size: 1rem;
        text-decoration: none;
        transition: background 0.3s ease;
        display: inline-block;
      }

      .btn-primary {
        background-color: #3b82f6;
        color: #fff;
      }

      .btn-primary:hover {
        background-color: #2563eb;
      }

      .btn-secondary {
        background-color: #e5e7eb;
        color: #1f2937;
      }

      .btn-secondary:hover {
        background-color: #d1d5db;
      }

      .stats {
        margin-top: 2rem;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 2rem;
        color: #fff;
      }

      .stat {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem 2rem;
        border-radius: 1rem;
        backdrop-filter: blur(5px);
        min-width: 150px;
      }

      .stat h3 {
        font-size: 2rem;
        margin: 0;
      }

      .stat p {
        margin: 0;
        font-size: 1rem;
      }

      .hero-carousel {
        position: relative;
        height: 100vh;
        overflow: hidden;
        font-family: "Cairo", sans-serif;
      }

      .carousel-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
      }

      .carousel-track {
        display: flex;
        height: 100%;
        width: 100%;
        transition: transform 0.5s ease;
      }

      .carousel-slide {
        min-width: 100%;
        height: 100%;
        flex-shrink: 0;
        background-size: cover;
        background-position: center;
        position: relative;
      }

      .overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.6),
          rgba(0, 0, 0, 0.1)
        );
        z-index: 1;
      }

      .slide-content {
        font-size: 2.2rem;
        margin-bottom: 500px;
        font-weight: 700;
        color: white;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      }

      .slide-content h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
      }

      .slide-content p {
        font-size: 1.2rem;
        line-height: 1.6;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
      }

      .slide-content .btn {
        margin: 0.5rem;
        padding: 0.75rem 1.5rem;
        border-radius: 30px;
        font-weight: bold;
        text-decoration: none;
        transition: 0.3s;
      }

      .btn-primary {
        background-color: #3b82f6;
        color: #fff;
      }

      .btn-secondary {
        background-color: #f3f4f6;
        color: #1f2937;
      }

      .btn-primary:hover {
        background-color: #2563eb;
      }

      .btn-secondary:hover {
        background-color: #e5e7eb;
      }

      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(255, 255, 255, 0.3);
        border: none;
        color: white;
        font-size: 2rem;
        padding: 0.5rem 1rem;
        cursor: pointer;
        z-index: 5;
        transition: 0.3s;
      }

      .carousel-btn:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }

      .carousel-btn.prev {
        left: 15px;
      }

      .carousel-btn.next {
        right: 15px;
      }

      /* جعل mainContent يأخذ المساحة المتاحة */
      #mainContent {
        flex: 1;
        width: 100%;
        height: calc(100vh - 120px);
        /* 120px = ارتفاع الهيدر + الفوتر */
        margin: 0;
        padding: 0;
        position: relative;
      }

      /* تعديلات السلايدر */
      .swiper-container {
        width: 100%;
        height: 100%;
      }

      .swiper-slide {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* التأكد من أن محتوى السلايد يغطي المساحة كاملة */
      .swiper-slide > div {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      /* تعديلات للغة الإنجليزية */
      body[dir="ltr"] .header-title {
        text-align: center;
      }

      body[dir="ltr"] .header-logos.right-logos {
        margin-left: auto;
      }

      body[dir="ltr"] .language-menu {
        left: auto;
        right: 0;
      }

      body[dir="ltr"] .social-icon {
        margin-left: 0;
        margin-right: 1rem;
      }

      body[dir="ltr"] .footer-content {
        direction: ltr;
      }

      body[dir="ltr"] .footer-logo {
        margin-right: 0;
        margin-left: 8px;
      }

      body[dir="ltr"] .copyright-text {
        direction: ltr;
      }

      body[dir="ltr"] .slide-content {
        text-align: center;
      }
    </style>
    <style>
      .tabs-container {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 50px; /* نفس ارتفاع الفوتر */
        z-index: 2001; /* أكبر من الفوتر */
        background: #fff;
        border-radius: 12px 12px 0 0;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.08);
        width: 100%;
        max-width: 100vw;
        border: 1px solid #ccc;
        overflow-x: auto;
        white-space: nowrap;
      }

      .tabs-header {
        display: flex;
        gap: 4px;
        padding: 6px;
      }

      .tab-button {
        display: flex;
        align-items: center;
        background: #e0e0e0;
        color: #333;
        border: none;
        border-radius: 8px 8px 0 0;
        padding: 6px 12px;
        font-size: 14px;
        position: relative;
        cursor: pointer;
        transition: background 0.3s;
      }

      .tab-button.active {
        background: #ffffff;
        border-bottom: 2px solid #007bff;
        font-weight: bold;
      }

      .tab-button:hover {
        background: #d0d0d0;
      }

      .tab-icon {
        margin-left: 6px;
        color: #007bff;
      }

      .tab-close:hover {
        color: red;
      }
    </style>
    <style>
      /* إضافة أنماط القائمة المنسدلة */
      .menu-dropdown {
        position: relative;
        display: inline-block;
      }

      .menu-toggle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.7);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 1.2rem;
      }

      .menu-toggle:hover {
        background: rgba(255, 255, 255, 0.32);
        transform: scale(1.05);
      }

      .menu-dropdown-content {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background-color: white;
        min-width: 160px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        z-index: 1000;
        margin-top: 5px;
      }

      .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        text-decoration: none;
        color: #333;
        transition: background-color 0.3s ease;
        font-size: 0.9rem;
      }

      .menu-item i {
        margin-left: 8px;
        width: 20px;
        text-align: center;
        font-size: 1rem;
      }

      .menu-item:hover {
        background-color: #f5f5f5;
      }

      /* تعديلات للغة الإنجليزية */
      body[dir="ltr"] .menu-dropdown-content {
        right: auto;
        left: 0;
      }

      body[dir="ltr"] .menu-item i {
        margin-left: 0;
        margin-right: 8px;
      }

      /* تحسين مظهر زر اللغة */
      .language-toggle {
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
        font-weight: bold;
        font-size: 1.1rem;
        border: 2px solid rgba(255, 255, 255, 0.7);
        outline: none;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: background 0.2s, border 0.2s, box-shadow 0.2s;
      }

      .language-toggle:hover {
        background: rgba(255, 255, 255, 0.32);
        border-color: #fff;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        color: #007bff;
      }

      /* تحسين مظهر الهيدر */
      #mainHeader {
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        background-color: #00b2e3;
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        height: 50px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header-title {
        flex: 1;
        text-align: center;
        font-weight: bold;
        font-size: 1.2rem;
        line-height: 1.4;
      }

      .header-logo {
        height: 40px;
        width: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
        object-fit: contain;
      }

      .header-logos {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 5px;
      }

      .header-logos img {
        height: 40px;
        width: 40px;
        object-fit: contain;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
      }

      .header-back-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        cursor: pointer;
        margin-left: 4px;
        transition: all 0.3s;
      }

      .header-back-btn:hover {
        background: rgba(255, 255, 255, 0.32);
        color: #007bff;
        border-color: #fff;
        transform: scale(1.08);
      }

      .header-back-btn i {
        font-size: 1.3rem;
      }
    </style>
    <!-- Map Toolbar CSS -->
    <style>
      .map-toolbar {
        position: absolute;
        top: 80px;
        right: 20px;
        z-index: 1202;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .map-toolbar button {
        background: #2196f3;
        color: #fff;
        border: none;
        border-radius: 6px;
        width: 44px;
        height: 44px;
        font-size: 1.3rem;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        transition: background 0.2s;
      }
      .map-toolbar button:hover {
        background: #1769aa;
      }
      .basemap-gallery-modal {
        display: none;
        position: absolute;
        top: 80px;
        right: 70px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
        z-index: 1300;
        padding: 16px;
        width: 350px;
      }
      .basemap-gallery-modal.open {
        display: block;
      }
      .basemap-gallery-modal .basemap-thumb {
        display: inline-block;
        width: 100px;
        height: 80px;
        margin: 6px;
        border: 2px solid #eee;
        border-radius: 6px;
        overflow: hidden;
        cursor: pointer;
        transition: border 0.2s;
      }
      .basemap-gallery-modal .basemap-thumb.selected,
      .basemap-gallery-modal .basemap-thumb:hover {
        border: 2px solid #2196f3;
      }
      .basemap-gallery-modal img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .basemap-gallery-modal .basemap-label {
        text-align: center;
        font-size: 0.9rem;
        margin-top: 2px;
      }
      body[dir="rtl"] .map-toolbar {
        right: auto;
        left: 20px;
      }
      body[dir="rtl"] .basemap-gallery-modal {
        right: auto;
        left: 70px;
      }
    </style>
    <!-- Leaflet Measure CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-measure/dist/leaflet-measure.css"
    />
    <style>
      .tabs-toggle-btn-container {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 50px; /* Match your footer height exactly */
        display: flex;
        justify-content: center;
        z-index: 2002;
        pointer-events: none;
      }
      .tabs-toggle-btn {
        pointer-events: auto;
        background: #3066ff;
        color: #fff;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        font-size: 1.6rem;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
      }
      .tabs-toggle-btn:hover {
        background: #ff4f30;
      }
    </style>
    <!-- Basemap Gallery Modal (bottom left, horizontal) -->
    <div id="basemap-gallery" class="basemap-gallery-modal"></div>
    <!-- Compass (bottom right) -->
    <div class="map-compass" title="الشمال">
      <img src="assets/img/map-compass.jpg" alt="Compass North" />
    </div>
    <style>
      .basemap-gallery-modal {
        display: none;
        flex-direction: row;
        position: fixed;
        left: 20px;
        bottom: 60px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
        z-index: 1300;
        padding: 8px 12px;
        gap: 10px;
        align-items: center;
        min-width: 180px;
        min-height: 60px;
      }
      .basemap-gallery-modal.open {
        display: flex;
      }
      .basemap-thumb img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #eee;
        background: #f8f8f8;
      }
      .basemap-thumb.selected img {
        border: 2px solid #3066ff;
      }
      .basemap-label {
        text-align: center;
        font-size: 12px;
        margin-top: 4px;
        color: #222;
      }
      .map-compass {
        position: fixed;
        right: 20px;
        bottom: 60px;
        width: 48px;
        height: 48px;
        z-index: 2003;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4px;
      }
      .map-compass img {
        width: 36px;
        height: 36px;
      }
    </style>
    <!-- Measurement Type Modal -->
    <div
      id="measure-type-modal"
      class="measure-type-modal"
      style="display: none"
    >
      <div class="measure-type-content">
        <h3>اختر نوع القياس</h3>
        <button id="measure-distance-btn" class="measure-type-btn">
          قياس مسافة
        </button>
        <button id="measure-area-btn" class="measure-type-btn">
          قياس مساحة
        </button>
        <button id="measure-cancel-btn" class="measure-type-cancel">
          إلغاء
        </button>
      </div>
    </div>
    <style>
      .measure-type-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.25);
        z-index: 3000;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .measure-type-content {
        background: #fff;
        border-radius: 12px;
        padding: 2rem 2.5rem 1.5rem 2.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
        text-align: center;
        min-width: 220px;
      }
      .measure-type-content h3 {
        margin-bottom: 1.2rem;
        color: #1e40af;
        font-size: 1.2rem;
      }
      .measure-type-btn {
        background: #2196f3;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0.7rem 1.5rem;
        margin: 0 0.5rem 0.5rem 0.5rem;
        font-size: 1rem;
        cursor: pointer;
        font-family: inherit;
        transition: background 0.2s;
      }
      .measure-type-btn:hover {
        background: #1769aa;
      }
      .measure-type-cancel {
        background: #eee;
        color: #333;
        border: none;
        border-radius: 8px;
        padding: 0.5rem 1.2rem;
        font-size: 0.95rem;
        cursor: pointer;
        margin-top: 0.5rem;
      }
      .measure-type-cancel:hover {
        background: #ddd;
      }
    </style>
    <!-- Measurement Result Floating Box -->
    <div
      id="measure-result-box"
      class="measure-result-box"
      style="display: none"
    ></div>
    <style>
      .measure-result-box {
        position: fixed;
        top: 80px;
        right: 30px;
        background: #fff;
        color: #1e40af;
        border-radius: 10px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.18);
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        font-weight: bold;
        z-index: 3001;
        min-width: 120px;
        text-align: center;
        border: 2px solid #2196f3;
        transition: opacity 0.3s;
      }
    </style>
    <!-- html2canvas for screenshot -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>

  <body>
    <!-- Header -->
    <header id="mainHeader" class="no-translate">
      <div style="display: flex; align-items: center; gap: 10px">
        <!-- شعار يسار -->
        <img
          src="assets/img/unhabitat.jfif"
          alt="Logo 3"
          class="header-logo"
          onclick="window.location.href='../admin.html'"
          style="cursor: pointer"
        />

        <!-- زر اللغة -->
        <div class="language-dropdown">
          <button
            class="language-toggle"
            id="langToggleBtn"
            onclick="toggleLanguage()"
          >
            AR
          </button>
        </div>
        <!-- زر القائمة -->
        <div class="menu-dropdown">
          <button class="menu-toggle" id="menuToggleBtn" onclick="toggleMenu()">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <div class="menu-dropdown-content" id="menuDropdown">
            <a href="#" class="menu-item" id="settingsBtn">
              <i class="fas fa-cog"></i>
              <span id="settingsText">الإعدادات</span>
            </a>
            <a href="#" class="menu-item" id="logoutBtn" onclick="logout()">
              <i class="fas fa-sign-out-alt"></i>
              <span id="logoutText">تسجيل الخروج</span>
            </a>
          </div>
        </div>
      </div>

      <!-- العنوان في الوسط -->
      <div class="header-title text-center">
        <div class="title-ar">نظام إدارة المعلومات الحضرية _ مدينة حلب</div>
        <div class="title-en">
          Urban Information Management System - Aleppo City
        </div>
      </div>

      <!-- شعاران على اليمين -->
      <div class="header-logos right-logos">
        <img
          src="assets/img/aleppo.jfif"
          alt="Logo 1"
          class="header-logo"
          onclick="window.location.href='../admin.html'"
          style="cursor: pointer"
        />
        <img
          src="assets/img/japan.png"
          alt="Logo 2"
          class="header-logo"
          onclick="window.location.href='../admin.html'"
          style="cursor: pointer"
        />
      </div>
    </header>

    <div class="mainContent">
      <div class="main-content">
        <div class="map-container">
          <div id="map"></div>
          <div class="tabs-container">
            <div class="tabs-header">
              <button class="tab-button active" data-tab="التدخلات_الإنسانية">
                <i class="fas fa-hands-helping tab-icon"></i>
                <span>التدخلات الإنسانية</span>
              </button>
              <button class="tab-button" data-tab="الأسواق_الأساسية">
                <i class="fas fa-shopping-cart tab-icon"></i>
                <span>الأسواق الأساسية</span>
              </button>
              <button class="tab-button" data-tab="إدارة_النفايات_الصلبة">
                <i class="fas fa-trash-alt tab-icon"></i>
                <span>إدارة النفايات الصلبة</span>
              </button>
              <button class="tab-button" data-tab="الحدائق_والمساحات_المعيشية">
                <i class="fas fa-tree tab-icon"></i>
                <span>الحدائق والمساحات المعيشية</span>
              </button>
              <button class="tab-button" data-tab="المرافق_التعليمية">
                <i class="fas fa-school tab-icon"></i>
                <span>المرافق التعليمية</span>
              </button>
              <button class="tab-button" data-tab="المراكز_الصحية">
                <i class="fas fa-hospital tab-icon"></i>
                <span>المراكز الصحية</span>
              </button>
              <button class="tab-button" data-tab="شبكة_الكهرباء">
                <i class="fas fa-bolt tab-icon"></i>
                <span>شبكة الكهرباء</span>
              </button>
              <button class="tab-button" data-tab="شبكة_الاتصالات">
                <i class="fas fa-network-wired tab-icon"></i>
                <span>شبكة الاتصالات</span>
              </button>
              <button class="tab-button" data-tab="إمدادات_المياه">
                <i class="fas fa-tint tab-icon"></i>
                <span>إمدادات المياه</span>
              </button>
              <button class="tab-button" data-tab="شبكة_الصرف_الصحي">
                <i class="fas fa-water tab-icon"></i>
                <span>شبكة الصرف الصحي</span>
              </button>
              <button class="tab-button" data-tab="أضرار_الإسكان">
                <i class="fas fa-home tab-icon"></i>
                <span>أضرار الإسكان</span>
              </button>
              <button class="tab-button" data-tab="النسيج_الحضري">
                <i class="fas fa-city tab-icon"></i>
                <span>النسيج الحضري</span>
              </button>
              <button class="tab-button" data-tab="التغيرات_السكانية">
                <i class="fas fa-users tab-icon"></i>
                <span>التغيرات السكانية</span>
              </button>
              <button class="tab-button" data-tab="أعضاء لجنة الحي">
                <i class="fas fa-user-friends tab-icon"></i>
                <span>أعضاء لجنة الحي</span>
              </button>
              <button
                class="tab-button"
                data-tab="معلومات التواصل مع لجنة الحي"
              >
                <i class="fas fa-address-book tab-icon"></i>
                <span>معلومات التواصل مع لجنة الحي</span>
              </button>
            </div>
          </div>

          <!-- Map Toolbar -->
          <div class="map-toolbar">
            <button id="zoom-in-btn" title="Zoom In">
              <i class="fas fa-search-plus"></i>
            </button>
            <button id="zoom-out-btn" title="Zoom Out">
              <i class="fas fa-search-minus"></i>
            </button>
            <button id="home-btn" title="Home">
              <i class="fas fa-home"></i>
            </button>
            <button id="layers-btn" title="Basemap Gallery">
              <i class="fas fa-layer-group"></i>
            </button>
            <button id="measure-btn" title="Measure">
              <i class="fas fa-ruler"></i>
            </button>
            <button id="draw-btn" title="Draw">
              <i class="fas fa-pencil-alt"></i>
            </button>
            <button id="printMapBtn" title="Print Map">
              <i class="fas fa-print"></i>
            </button>
          </div>
          <!-- Basemap Gallery Modal -->
          <div id="basemap-gallery" class="basemap-gallery-modal"></div>
          <!-- Compass (bottom right) -->
          <div class="map-compass" title="الشمال">
            <img src="assets/img/Compass_rose_simple.svg" alt="Compass North" />
          </div>
          <!-- Map Toolbar CSS -->
          <style>
            .map-toolbar {
              position: absolute;
              top: 80px;
              right: 20px;
              z-index: 1202;
              display: flex;
              flex-direction: column;
              gap: 10px;
            }
            .map-toolbar button {
              background: #2196f3;
              color: #fff;
              border: none;
              border-radius: 6px;
              width: 44px;
              height: 44px;
              font-size: 1.3rem;
              cursor: pointer;
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
              transition: background 0.2s;
            }
            .map-toolbar button:hover {
              background: #1769aa;
            }
            .basemap-gallery-modal {
              display: none;
              position: absolute;
              top: 80px;
              right: 70px;
              background: #fff;
              border-radius: 10px;
              box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
              z-index: 1300;
              padding: 16px;
              width: 350px;
            }
            .basemap-gallery-modal.open {
              display: block;
            }
            .basemap-gallery-modal .basemap-thumb {
              display: inline-block;
              width: 100px;
              height: 80px;
              margin: 6px;
              border: 2px solid #eee;
              border-radius: 6px;
              overflow: hidden;
              cursor: pointer;
              transition: border 0.2s;
            }
            .basemap-gallery-modal .basemap-thumb.selected,
            .basemap-gallery-modal .basemap-thumb:hover {
              border: 2px solid #2196f3;
            }
            .basemap-gallery-modal img {
              width: 100%;
              height: 100%;
              object-fit: cover;
            }
            .basemap-gallery-modal .basemap-label {
              text-align: center;
              font-size: 0.9rem;
              margin-top: 2px;
            }
            body[dir="rtl"] .map-toolbar {
              right: auto;
              left: 20px;
            }
            body[dir="rtl"] .basemap-gallery-modal {
              right: auto;
              left: 70px;
            }
          </style>
          <div id="map"></div>
          <div class="tab-content">
            <!-- Tab content will be dynamically added here -->
          </div>

          <!-- Info Panel -->
          <div id="modal-backdrop" class="modal-backdrop"></div>
          <div id="info-panel" class="info-panel">
            <button id="close-info-panel" class="close-btn">&times;</button>
            <h3 id="info-title"></h3>
            <div id="info-content"></div>
          </div>
        </div>
      </div>

      <!-- Left Sidebar - Layers Management -->
      <aside id="leftSidebar" class="sidebar left-sidebar">
        <div class="sidebar-header">
          <h3>إدارة الطبقات</h3>
          <button id="toggleLeftSidebar" class="sidebar-toggle">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <!-- Indicador de cierre automático -->
        <div id="leftSidebarAutoCloseIndicator" class="auto-close-indicator">
          <span class="auto-close-countdown"></span>
          <span>سيتم الإغلاق تلقائيًا</span>
        </div>
        <div class="sidebar-content" style="margin-bottom: 110px">
          <!-- Base Layers Section -->

          <div class="sidebar-section">
            <h4>الطبقات</h4>
            <div id="layersList" class="layer-list">
              <!-- Layers will be populated dynamically -->
              <div class="layer-item">
                <div class="layer-toggle">
                  <input type="checkbox" id="layer-neighborhoods" checked />
                  <label for="layer-neighborhoods">الأحياء</label>
                </div>
                <div class="layer-actions">
                  <button
                    class="layer-action-btn"
                    data-action="zoom"
                    data-layer="neighborhoods"
                  >
                    <i class="fas fa-search-plus"></i>
                  </button>
                  <button
                    class="layer-action-btn"
                    data-action="info"
                    data-layer="neighborhoods"
                  >
                    <i class="fas fa-info-circle"></i>
                  </button>
                </div>
              </div>
              <div class="layer-item">
                <div class="layer-toggle">
                  <input type="checkbox" id="layer-service-sectors" checked />
                  <label for="layer-service-sectors">دوائر الخدمات</label>
                </div>
                <div class="layer-actions">
                  <button
                    class="layer-action-btn"
                    data-action="zoom"
                    data-layer="service-sectors"
                  >
                    <i class="fas fa-search-plus"></i>
                  </button>
                  <button
                    class="layer-action-btn"
                    data-action="info"
                    data-layer="service-sectors"
                  >
                    <i class="fas fa-info-circle"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="sidebar-section">
            <h4 class="sidebar-section-title">
              <i class="fas fa-map sidebar-icon"></i>
              الخرائط الأساسية
            </h4>
            <div id="baseLayers" class="base-layers">
              <div class="base-layer-option" data-basemap="osm">
                <input type="radio" name="basemap" id="osm" checked />
                <label for="osm" class="mr-2">خريطة الشارع المفتوحة</label>
              </div>
              <div class="base-layer-option" data-basemap="satellite">
                <input type="radio" name="basemap" id="satellite" />
                <label for="satellite" class="mr-2">صور الأقمار الصناعية</label>
              </div>
              <div class="base-layer-option" data-basemap="terrain">
                <input type="radio" name="basemap" id="terrain" />
                <label for="terrain" class="mr-2">التضاريس</label>
              </div>
            </div>
          </div>
          <div class="sidebar-section">
            <h4>تصدير / استيراد</h4>
            <div class="import-export-controls">
              <button id="importLayerBtn" class="sidebar-button">
                <i class="fas fa-file-import"></i> استيراد طبقة
              </button>
              <input
                type="file"
                id="layerFileInput"
                accept=".geojson,.kml,.shp,.zip"
                style="display: none"
              />

              <button id="exportLayerBtn" class="sidebar-button">
                <i class="fas fa-file-export"></i> تصدير طبقة
              </button>

              <button id="printMapBtn" class="sidebar-button">
                <i class="fas fa-print"></i> طباعة الخريطة
              </button>

              <div class="layer-selector">
                <label for="exportLayerSelect">اختر الطبقة:</label>
                <select id="exportLayerSelect" class="sidebar-select">
                  <option value="neighborhoods">الأحياء</option>
                  <option value="service-sectors">القطاعات الخدمية</option>
                  <option value="neighborhood-labels">مسميات الأحياء</option>
                </select>
              </div>

              <div class="format-selector">
                <label for="exportFormat">صيغة التصدير:</label>
                <select id="exportFormat" class="sidebar-select">
                  <option value="geojson">GeoJSON</option>
                  <option value="kml">KML</option>
                  <option value="shp">Shapefile (ZIP)</option>
                  <option value="csv">CSV</option>
                </select>
              </div>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>الرموز والألوان</h4>
            <div id="symbolEditor" class="symbol-editor">
              <select id="layerStyleSelect" class="sidebar-select">
                <option value="">اختر طبقة...</option>
                <option value="neighborhoods">الأحياء</option>
                <option value="service-sectors">دوائر الخدمات</option>
              </select>

              <div class="style-options" id="styleOptions">
                <div class="style-option">
                  <label>اللون:</label>
                  <input type="color" id="layerColor" value="#1e40af" />
                </div>

                <div class="style-option">
                  <label>الشفافية:</label>
                  <input
                    type="range"
                    id="layerOpacity"
                    min="0"
                    max="1"
                    step="0.1"
                    value="0.8"
                  />
                  <span id="opacityValue">0.8</span>
                </div>

                <div class="style-option">
                  <label>سمك الخط:</label>
                  <input
                    type="number"
                    id="lineWeight"
                    min="1"
                    max="10"
                    value="2"
                  />
                </div>

                <button id="applyStyleBtn" class="sidebar-button">
                  <i class="fas fa-check"></i> تطبيق
                </button>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Right Sidebar - Analysis and Queries -->
      <aside id="rightSidebar" class="sidebar right-sidebar">
        <div class="sidebar-header">
          <button id="toggleRightSidebar" class="sidebar-toggle">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h3>التحليلات والاستعلامات</h3>
        </div>
        <!-- Indicador de cierre automático -->
        <div id="rightSidebarAutoCloseIndicator" class="auto-close-indicator">
          <span class="auto-close-countdown"></span>
          <span>سيتم الإغلاق تلقائيًا</span>
        </div>
        <div class="sidebar-content" style="margin-bottom: 95px">
          <div class="sidebar-section">
            <h4>منشئ الاستعلامات</h4>
            <div id="queryBuilder" class="query-builder">
              <div class="query-builder-row">
                <select id="queryTableSelect" class="sidebar-select">
                  <option value="">اختر طبقة...</option>
                  <option value="neighborhoods">الأحياء</option>
                  <option value="service-sectors">دوائر الخدمات</option>
                </select>
              </div>

              <div class="query-builder-row">
                <select id="queryFieldSelect" class="sidebar-select">
                  <option value="">اختر حقل...</option>
                </select>
              </div>

              <div class="query-builder-row">
                <select id="queryOperatorSelect" class="sidebar-select">
                  <option value="">اختر العملية...</option>
                  <option value="=">=</option>
                  <option value="<>">≠</option>
                  <option value=">">></option>
                  <option value="<"><< /option></option>

                  <option value=">=">≥</option>
                  <option value="<=">≤</option>
                  <option value="like">يحتوي</option>
                </select>
              </div>

              <div class="query-builder-row">
                <div class="value-input-container">
                  <input
                    type="text"
                    id="queryValueInput"
                    class="sidebar-input"
                    placeholder="أدخل القيمة"
                  />
                  <button id="valueListBtn" class="sidebar-button small-button">
                    <i class="fas fa-list"></i>
                  </button>
                </div>
              </div>

              <button id="addConditionBtn" class="sidebar-button">
                <i class="fas fa-plus"></i> إضافة شرط
              </button>

              <div id="queryConditions" class="query-conditions">
                <!-- Conditions will be added here -->
              </div>

              <button id="runQueryBtn" class="sidebar-button primary-button">
                <i class="fas fa-play"></i> تنفيذ الاستعلام
              </button>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>نتائج الاستعلام</h4>
            <div id="queryResults" class="query-results">
              <div class="empty-state">
                قم بإنشاء استعلام وتنفيذه لعرض النتائج
              </div>
            </div>
          </div>
          <div class="sidebar-section">
            <h4><i class="fas fa-filter"></i> تصفية الأحياء حسب القطاع</h4>
            <div class="filter-container">
              <select id="sectorFilterSelect" class="sidebar-select">
                <option value="">كل القطاعات</option>
                <!-- سيتم تعبئة هذه القائمة تلقائ -->
              </select>
              <button
                id="applySectorFilterBtn"
                class="sidebar-button futuristic-button"
              >
                <i class="fas fa-check"></i> تطبيق
              </button>
            </div>
            <div id="filterResults" class="filter-results">
              <!-- نتائج التصفية تظهر هنا -->
            </div>
            <div class="filter-actions">
              <button
                id="exportFilteredBtn"
                class="sidebar-button futuristic-button"
              >
                <i class="fas fa-file-export"></i> تصدير النتائج المصفاة
              </button>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>تحليل بياني</h4>
            <div class="visualization-controls">
              <select id="chartType" class="sidebar-select">
                <option value="">اختر نوع الرسم البياني...</option>
                <option value="bar">رسم شريطي</option>
                <option value="pie">رسم دائري</option>
                <option value="line">رسم خطي</option>
                <option value="radar">رسم رادار</option>
              </select>

              <select id="chartData" class="sidebar-select">
                <option value="">اختر البيانات...</option>
                <option value="area">المساحة</option>
                <option value="sector">القطاع</option>
                <option value="population">عدد السكان</option>
                <option value="damage">نسبة الضرر</option>
              </select>

              <button id="generateChartBtn" class="sidebar-button">
                <i class="fas fa-chart-pie"></i> إنشاء الرسم البياني
              </button>
            </div>

            <div class="chart-container">
              <canvas id="analysisChart"></canvas>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>تحليلات متقدمة</h4>
            <div class="advanced-analysis">
              <button id="densityAnalysisBtn" class="sidebar-button">
                <i class="fas fa-users"></i> تحليل الكثافة السكانية
              </button>

              <button id="infrastructureAnalysisBtn" class="sidebar-button">
                <i class="fas fa-road"></i> تحليل البنية التحتية
              </button>

              <button id="serviceAccessAnalysisBtn" class="sidebar-button">
                <i class="fas fa-hospital"></i> تحليل الوصول للخدمات
              </button>

              <button id="damageAnalysisBtn" class="sidebar-button">
                <i class="fas fa-house-damage"></i> تحليل الأضرار
              </button>
            </div>
          </div>
        </div>
      </aside>
    </div>
    <!-- Footer -->
    <footer id="mainFooter" class="no-translate">
      <div class="footer-content">
        <div class="copyright">
          <span class="copyright-text">
            ©
            <script>
              document.write(new Date().getFullYear());
            </script>
            , <span id="rightsText">Powerd by</span>
            <a
              class="companyHITech"
              href="https://www.hi-techhouse.com"
              target="_blank"
              id="companyName"
              >HI-Tech House</a
            >
          </span>
          <img
            alt="Company Logo"
            src="assets/img/HTH.png"
            class="footer-logo"
          />
        </div>
        <div class="social-icons">
          <a aria-label="Facebook" class="social-icon facebook" href="#"
            ><i class="fab fa-facebook-f"></i
          ></a>
          <a aria-label="Twitter" class="social-icon twitter" href="#"
            ><i class="fab fa-x-twitter"></i
          ></a>
          <a aria-label="Instagram" class="social-icon instagram" href="#"
            ><i class="fab fa-instagram"></i
          ></a>
          <a aria-label="LinkedIn" class="social-icon linkedin" href="#"
            ><i class="fab fa-linkedin-in"></i
          ></a>
          <a
            aria-label="WhatsApp"
            class="social-icon whatsapp"
            href="https://wa.me/966501234567"
            ><i class="fab fa-whatsapp"></i
          ></a>
        </div>
      </div>
    </footer>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- shpjs for Shapefile import -->
    <script src="https://unpkg.com/shpjs@latest/dist/shp.min.js"></script>

    <!-- Leaflet Plugins -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- Leaflet Draw JS -->
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <!-- Leaflet Measure JS -->
    <script src="https://unpkg.com/leaflet-measure/dist/leaflet-measure.js"></script>

    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Application Data & Scripts -->
    <script src="main.js"></script>
    <script src="js/service-sectors.js"></script>
    <script src="attached_assets/aleppo-data.js"></script>
    <script src="attached_assets/neighborhoods-data.js"></script>
    <script src="attached_assets/aleppo-analysis.js"></script>
    <script src="js/field-translations.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/map.js"></script>
    <script src="js/query.js"></script>
    <script src="js/hydraulic-billing.js"></script>
    <script src="js/import-export.js"></script>
    <script src="js/features.js"></script>
    <script src="js/tabs.js"></script>
    <script src="js/info-panel-formatter.js"></script>
    <script>
      // Fix for white space issue when clicking on the map
      document.addEventListener("click", function (e) {
        if (e.target && (e.target.id === "map" || e.target.closest("#map"))) {
          setTimeout(function () {
            if (window.map && typeof window.map.invalidateSize === "function") {
              window.map.invalidateSize(true);
            }
          }, 100);
        }
      });

      const translations = {
        ar: {
          title: "نظام الإدارة الحضرية لمدينة حلب",
          settingsText: "إعدادات الحساب",
          logoutText: "تسجيل الخروج",
          rightsText: "Powerd by",
          companyName: "HI-Tech House",
          // Info panel buttons
          cancelChanges: "إلغاء التعديلات",
          saveChanges: "حفظ التغييرات",
          // Tab names
          tabs: {
            التدخلات_الإنسانية: "التدخلات الإنسانية",
            الأسواق_الأساسية: "الأسواق الأساسية",
            إدارة_النفايات_الصلبة: "إدارة النفايات الصلبة",
            الحدائق_والمساحات_المعيشية: "الحدائق والمساحات المعيشية",
            المرافق_التعليمية: "المرافق التعليمية",
            المراكز_الصحية: "المراكز الصحية",
            شبكة_الكهرباء: "شبكة الكهرباء",
            شبكة_الاتصالات: "شبكة الاتصالات",
            إمدادات_المياه: "إمدادات المياه",
            شبكة_الصرف_الصحي: "شبكة الصرف الصحي",
            أضرار_الإسكان: "أضرار الإسكان",
            النسيج_الحضري: "النسيج الحضري",
            التغيرات_السكانية: "التغيرات السكانية",
            "أعضاء لجنة الحي": "أعضاء لجنة الحي",
            "معلومات التواصل مع لجنة الحي": "معلومات التواصل مع لجنة الحي",
          },
          // Sidebar labels
          sidebar: {
            layersManagement: "إدارة الطبقات",
            baseMaps: "الخرائط الأساسية",
            openStreetMap: "خريطة الشارع المفتوحة",
            satellite: "صور الأقمار الصناعية",
            terrain: "التضاريس",
            layers: "الطبقات",
            neighborhoods: "الأحياء",
            serviceSectors: "دوائر الخدمات",
            importExport: "تصدير / استيراد",
            importLayer: "استيراد طبقة",
            exportLayer: "تصدير طبقة",
            exportFormat: "صيغة التصدير",
            symbolsColors: "الرموز والألوان",
            chooseLayer: "اختر طبقة...",
            color: "اللون:",
            transparency: "الشفافية:",
            lineWeight: "سمك الخط:",
            apply: "تطبيق",
          },
          // Right sidebar
          analysisQueries: {
            title: "التحليلات والاستعلامات",
            queryBuilder: "منشئ الاستعلامات",
            chooseLayer: "اختر طبقة...",
            chooseField: "اختر حقل...",
            chooseOperation: "اختر العملية...",
            enterValue: "أدخل القيمة",
            addCondition: "إضافة شرط",
            runQuery: "تنفيذ الاستعلام",
            queryResults: "نتائج الاستعلام",
            createQueryMessage: "قم بإنشاء استعلام وتنفيذه لعرض النتائج",
            filterBySection: "تصفية الأحياء حسب القطاع",
            allSectors: "كل القطاعات",
            apply: "تطبيق",
            exportFilteredResults: "تصدير النتائج المصفاة",
            chartAnalysis: "تحليل بياني",
            chooseChartType: "اختر نوع الرسم البياني...",
            barChart: "رسم شريطي",
            pieChart: "رسم دائري",
            lineChart: "رسم خطي",
            radarChart: "رسم رادار",
            chooseData: "اختر البيانات...",
            area: "المساحة",
            sector: "القطاع",
            population: "عدد السكان",
            damage: "نسبة الضرر",
            generateChart: "إنشاء الرسم البياني",
            advancedAnalysis: "تحليلات متقدمة",
            populationDensity: "تحليل الكثافة السكانية",
            infrastructure: "تحليل البنية التحتية",
            serviceAccess: "تحليل الوصول للخدمات",
            damageAnalysis: "تحليل الأضرار",
          },
          // Map controls
          mapControls: {
            layers: "الطبقات",
          },
        },
        en: {
          title: "Urban Management System for Aleppo",
          settingsText: "Account Settings",
          logoutText: "Logout",
          rightsText: "Powerd by",
          companyName: "Hi-Tech House",
          // Info panel buttons
          cancelChanges: "Cancel Changes",
          saveChanges: "Save Changes",
          // Tab names
          tabs: {
            التدخلات_الإنسانية: "Humanitarian Interventions",
            الأسواق_الأساسية: "Basic Markets",
            إدارة_النفايات_الصلبة: "Solid Waste Management",
            الحدائق_والمساحات_المعيشية: "Parks and Living Spaces",
            المرافق_التعليمية: "Educational Facilities",
            المراكز_الصحية: "Health Centers",
            شبكة_الكهرباء: "Electricity Network",
            شبكة_الاتصالات: "Communications Network",
            إمدادات_المياه: "Water Supply",
            شبكة_الصرف_الصحي: "Sewage Network",
            أضرار_الإسكان: "Housing Damage",
            النسيج_الحضري: "Urban Fabric",
            التغيرات_السكانية: "Population Changes",
            "أعضاء لجنة الحي": "Neighborhood Committee Members",
            "معلومات التواصل مع لجنة الحي":
              "Neighborhood Committee Contact Info",
          },
          // Sidebar labels
          sidebar: {
            layersManagement: "Layers Management",
            baseMaps: "Base Maps",
            openStreetMap: "OpenStreetMap",
            satellite: "Satellite Imagery",
            terrain: "Terrain",
            layers: "Layers",
            neighborhoods: "Neighborhoods",
            serviceSectors: "Service Sectors",
            importExport: "Import / Export",
            importLayer: "Import Layer",
            exportLayer: "Export Layer",
            exportFormat: "Export Format",
            symbolsColors: "Symbols and Colors",
            chooseLayer: "Choose Layer...",
            color: "Color:",
            transparency: "Transparency:",
            lineWeight: "Line Weight:",
            apply: "Apply",
          },
          // Right sidebar
          analysisQueries: {
            title: "Analysis and Queries",
            queryBuilder: "Query Builder",
            chooseLayer: "Choose Layer...",
            chooseField: "Choose Field...",
            chooseOperation: "Choose Operation...",
            enterValue: "Enter Value",
            addCondition: "Add Condition",
            runQuery: "Run Query",
            queryResults: "Query Results",
            createQueryMessage: "Create and run a query to view results",
            filterBySection: "Filter Neighborhoods by Sector",
            allSectors: "All Sectors",
            apply: "Apply",
            exportFilteredResults: "Export Filtered Results",
            chartAnalysis: "Chart Analysis",
            chooseChartType: "Choose Chart Type...",
            barChart: "Bar Chart",
            pieChart: "Pie Chart",
            lineChart: "Line Chart",
            radarChart: "Radar Chart",
            chooseData: "Choose Data...",
            area: "Area",
            sector: "Sector",
            population: "Population",
            damage: "Damage Percentage",
            generateChart: "Generate Chart",
            advancedAnalysis: "Advanced Analysis",
            populationDensity: "Population Density Analysis",
            infrastructure: "Infrastructure Analysis",
            serviceAccess: "Service Access Analysis",
            damageAnalysis: "Damage Analysis",
          },
          // Map controls
          mapControls: {
            layers: "Layers",
          },
        },
      };

      // Make translations available globally
      window.translations = translations;

      function toggleLanguage() {
        // تبديل اللغة بين العربية والإنجليزية
        const currentLang = document.documentElement.lang || "ar";
        const newLang = currentLang === "ar" ? "en" : "ar";
        switchLanguage(newLang);

        // تحديث نص زر اللغة
        const langToggleBtn = document.getElementById("langToggleBtn");
        if (langToggleBtn) {
          langToggleBtn.textContent = newLang.toUpperCase();
        }

        // حفظ اللغة المختارة في التخزين المحلي
        localStorage.setItem("selectedLanguage", newLang);
      }

      function switchLanguage(lang) {
        // تغيير اتجاه الصفحة
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";

        // Apply fixed direction to no-translate elements
        document.querySelectorAll(".no-translate").forEach((element) => {
          // Keep header and footer with fixed direction regardless of language
          element.style.direction = "rtl"; // Always keep RTL for header and footer

          // Ensure the layout doesn't change when switching languages
          if (element.id === "mainHeader") {
            // Fix header elements
            const rightLogos = element.querySelector(
              ".header-logos.right-logos"
            );
            const leftControls = element.querySelector("div:first-child");
            const title = element.querySelector(".header-title");

            if (rightLogos) rightLogos.style.right = "20px";
            if (leftControls) leftControls.style.left = "20px";
            if (title) {
              title.style.left = "50%";
              title.style.transform = "translateX(-50%)";
            }
          } else if (element.id === "mainFooter") {
            // Fix footer elements
            const copyright = element.querySelector(".copyright");
            const socialIcons = element.querySelector(".social-icons");

            if (copyright) copyright.style.left = "20px";
            if (socialIcons) socialIcons.style.right = "20px";
          }
        });

        // تحديث النصوص
        const t = translations[lang];
        document.title = t.title;

        // Skip translation for elements with no-translate class
        const noTranslateElements = document.querySelectorAll(".no-translate");

        // تحديث القائمة - only if not in a no-translate container
        const settingsText = document.getElementById("settingsText");
        const logoutText = document.getElementById("logoutText");
        // We'll skip translating these elements since they're in the header
        // if (settingsText && !isInNoTranslateContainer(settingsText))
        //   settingsText.textContent = t.settingsText;
        // if (logoutText && !isInNoTranslateContainer(logoutText))
        //   logoutText.textContent = t.logoutText;

        // تحديث الفوتر - only if not in a no-translate container
        const rightsText = document.getElementById("rightsText");
        const companyName = document.getElementById("companyName");
        // We'll skip translating these elements since they're in the footer
        // if (rightsText && !isInNoTranslateContainer(rightsText))
        //   rightsText.textContent = t.rightsText;
        // if (companyName && !isInNoTranslateContainer(companyName))
        //   companyName.textContent = t.companyName;

        // تحديث العناوين - only if not in a no-translate container
        const titleAr = document.querySelector(".title-ar");
        const titleEn = document.querySelector(".title-en");

        // We'll skip changing the visibility of these elements since they're in the header
        // if (titleAr && !isInNoTranslateContainer(titleAr)) {
        //   titleAr.style.display = lang === "ar" ? "block" : "none";
        // }

        // if (titleEn && !isInNoTranslateContainer(titleEn)) {
        //   titleEn.style.display = lang === "en" ? "block" : "none";
        // }

        // تحديث أسماء التبويبات
        if (t.tabs) {
          document.querySelectorAll(".tab-button").forEach((button) => {
            if (isInNoTranslateContainer(button)) return;

            const tabId = button.getAttribute("data-tab");
            const tabSpan = button.querySelector("span:not(.tab-close)");
            if (tabSpan && tabId && t.tabs[tabId]) {
              tabSpan.textContent = t.tabs[tabId];
            }
          });
        }

        // تحديث نص زر الطبقات
        const layersToggleAfter = document.querySelector(
          ".leaflet-control-layers-toggle::after"
        );
        if (
          layersToggleAfter &&
          t.mapControls &&
          t.mapControls.layers &&
          !isInNoTranslateContainer(layersToggleAfter)
        ) {
          document.documentElement.style.setProperty(
            "--layers-text",
            `"${t.mapControls.layers}"`
          );
        }

        // تحديث العناصر في الشريط الجانبي الأيسر
        if (t.sidebar) {
          // عناوين الأقسام
          const layersManagementTitle = document.querySelector(
            "#leftSidebar .sidebar-header h3"
          );
          if (
            layersManagementTitle &&
            !isInNoTranslateContainer(layersManagementTitle)
          ) {
            layersManagementTitle.textContent = t.sidebar.layersManagement;
          }

          // عنوان الخرائط الأساسية
          const baseMapsTitle = document.querySelector(
            ".sidebar-section-title"
          );
          if (baseMapsTitle) {
            const iconSpan = baseMapsTitle.querySelector("i");
            baseMapsTitle.innerHTML = "";
            if (iconSpan) baseMapsTitle.appendChild(iconSpan);
            baseMapsTitle.appendChild(
              document.createTextNode(t.sidebar.baseMaps)
            );
          }

          // خيارات الخرائط الأساسية
          const osmLabel = document.querySelector('label[for="osm"]');
          const satelliteLabel = document.querySelector(
            'label[for="satellite"]'
          );
          const terrainLabel = document.querySelector('label[for="terrain"]');

          if (osmLabel) osmLabel.textContent = t.sidebar.openStreetMap;
          if (satelliteLabel) satelliteLabel.textContent = t.sidebar.satellite;
          if (terrainLabel) terrainLabel.textContent = t.sidebar.terrain;

          // عنوان الطبقات
          const layersTitle = document.querySelector(
            ".sidebar-section h4:not(.sidebar-section-title)"
          );
          if (layersTitle) layersTitle.textContent = t.sidebar.layers;

          // أسماء الطبقات
          const neighborhoodsLabel = document.querySelector(
            'label[for="layer-neighborhoods"]'
          );
          const serviceSectorsLabel = document.querySelector(
            'label[for="layer-service-sectors"]'
          );

          if (neighborhoodsLabel)
            neighborhoodsLabel.textContent = t.sidebar.neighborhoods;
          if (serviceSectorsLabel)
            serviceSectorsLabel.textContent = t.sidebar.serviceSectors;

          // قسم التصدير/الاستيراد
          const importExportTitle = document.querySelector(
            ".sidebar-section:nth-child(3) h4"
          );
          if (importExportTitle)
            importExportTitle.textContent = t.sidebar.importExport;

          const importLayerBtn = document.getElementById("importLayerBtn");
          const exportLayerBtn = document.getElementById("exportLayerBtn");
          const exportFormatLabel = document.querySelector(
            'label[for="exportFormat"]'
          );

          if (importLayerBtn) {
            const iconElement = importLayerBtn.querySelector("i");
            importLayerBtn.innerHTML = "";
            if (iconElement) importLayerBtn.appendChild(iconElement);
            importLayerBtn.appendChild(
              document.createTextNode(" " + t.sidebar.importLayer)
            );
          }

          if (exportLayerBtn) {
            const iconElement = exportLayerBtn.querySelector("i");
            exportLayerBtn.innerHTML = "";
            if (iconElement) exportLayerBtn.appendChild(iconElement);
            exportLayerBtn.appendChild(
              document.createTextNode(" " + t.sidebar.exportLayer)
            );
          }

          if (exportFormatLabel)
            exportFormatLabel.textContent = t.sidebar.exportFormat + ":";

          // قسم الرموز والألوان
          const symbolsColorsTitle = document.querySelector(
            ".sidebar-section:nth-child(4) h4"
          );
          if (symbolsColorsTitle)
            symbolsColorsTitle.textContent = t.sidebar.symbolsColors;

          // تحديث خيارات الطبقات
          const layerStyleSelect = document.getElementById("layerStyleSelect");
          if (layerStyleSelect) {
            const firstOption =
              layerStyleSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = t.sidebar.chooseLayer;

            const neighborhoodsOption = layerStyleSelect.querySelector(
              "option[value='neighborhoods']"
            );
            const serviceSectorsOption = layerStyleSelect.querySelector(
              "option[value='service-sectors']"
            );

            if (neighborhoodsOption)
              neighborhoodsOption.textContent = t.sidebar.neighborhoods;
            if (serviceSectorsOption)
              serviceSectorsOption.textContent = t.sidebar.serviceSectors;
          }

          // تحديث خيارات التنسيق
          const colorLabel = document.querySelector(
            ".style-option:nth-child(1) label"
          );
          const opacityLabel = document.querySelector(
            ".style-option:nth-child(2) label"
          );
          const lineWeightLabel = document.querySelector(
            ".style-option:nth-child(3) label"
          );
          const applyStyleBtn = document.getElementById("applyStyleBtn");

          if (colorLabel) colorLabel.textContent = t.sidebar.color;
          if (opacityLabel) opacityLabel.textContent = t.sidebar.transparency;
          if (lineWeightLabel)
            lineWeightLabel.textContent = t.sidebar.lineWeight;

          if (applyStyleBtn) {
            const iconElement = applyStyleBtn.querySelector("i");
            applyStyleBtn.innerHTML = "";
            if (iconElement) applyStyleBtn.appendChild(iconElement);
            applyStyleBtn.appendChild(
              document.createTextNode(" " + t.sidebar.apply)
            );
          }
        }

        // تحديث العناصر في الشريط الجانبي الأيمن
        if (t.analysisQueries) {
          const aq = t.analysisQueries;

          // عنوان الشريط الجانبي
          const rightSidebarTitle = document.querySelector(
            "#rightSidebar .sidebar-header h3"
          );
          if (rightSidebarTitle) rightSidebarTitle.textContent = aq.title;

          // عنوان منشئ الاستعلامات
          const queryBuilderTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(1) h4"
          );
          if (queryBuilderTitle)
            queryBuilderTitle.textContent = aq.queryBuilder;

          // خيارات الاستعلام
          const queryTableSelect = document.getElementById("queryTableSelect");
          const queryFieldSelect = document.getElementById("queryFieldSelect");
          const queryOperatorSelect = document.getElementById(
            "queryOperatorSelect"
          );
          const queryValueInput = document.getElementById("queryValueInput");

          if (queryTableSelect) {
            const firstOption =
              queryTableSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.chooseLayer;
          }

          if (queryFieldSelect) {
            const firstOption =
              queryFieldSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.chooseField;
          }

          if (queryOperatorSelect) {
            const firstOption =
              queryOperatorSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.chooseOperation;
          }

          if (queryValueInput) queryValueInput.placeholder = aq.enterValue;

          // أزرار الاستعلام
          const addConditionBtn = document.getElementById("addConditionBtn");
          const runQueryBtn = document.getElementById("runQueryBtn");

          if (addConditionBtn) {
            const iconElement = addConditionBtn.querySelector("i");
            addConditionBtn.innerHTML = "";
            if (iconElement) addConditionBtn.appendChild(iconElement);
            addConditionBtn.appendChild(
              document.createTextNode(" " + aq.addCondition)
            );
          }

          if (runQueryBtn) {
            const iconElement = runQueryBtn.querySelector("i");
            runQueryBtn.innerHTML = "";
            if (iconElement) runQueryBtn.appendChild(iconElement);
            runQueryBtn.appendChild(document.createTextNode(" " + aq.runQuery));
          }

          // عنوان نتائج الاستعلام
          const queryResultsTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(2) h4"
          );
          if (queryResultsTitle)
            queryResultsTitle.textContent = aq.queryResults;

          // رسالة نتائج الاستعلام الفارغة
          const emptyState = document.querySelector(
            ".query-results .empty-state"
          );
          if (emptyState) emptyState.textContent = aq.createQueryMessage;

          // قسم التصفية
          const filterTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(3) h4"
          );
          if (filterTitle) {
            const iconElement = filterTitle.querySelector("i");
            filterTitle.innerHTML = "";
            if (iconElement) filterTitle.appendChild(iconElement);
            filterTitle.appendChild(
              document.createTextNode(" " + aq.filterBySection)
            );
          }

          // خيارات التصفية
          const sectorFilterSelect =
            document.getElementById("sectorFilterSelect");
          const applySectorFilterBtn = document.getElementById(
            "applySectorFilterBtn"
          );
          const exportFilteredBtn =
            document.getElementById("exportFilteredBtn");

          if (sectorFilterSelect) {
            const firstOption =
              sectorFilterSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.allSectors;
          }

          if (applySectorFilterBtn) {
            const iconElement = applySectorFilterBtn.querySelector("i");
            applySectorFilterBtn.innerHTML = "";
            if (iconElement) applySectorFilterBtn.appendChild(iconElement);
            applySectorFilterBtn.appendChild(
              document.createTextNode(" " + aq.apply)
            );
          }

          if (exportFilteredBtn) {
            const iconElement = exportFilteredBtn.querySelector("i");
            exportFilteredBtn.innerHTML = "";
            if (iconElement) exportFilteredBtn.appendChild(iconElement);
            exportFilteredBtn.appendChild(
              document.createTextNode(" " + aq.exportFilteredResults)
            );
          }

          // قسم التحليل البياني
          const chartAnalysisTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(4) h4"
          );
          if (chartAnalysisTitle)
            chartAnalysisTitle.textContent = aq.chartAnalysis;

          // خيارات الرسم البياني
          const chartType = document.getElementById("chartType");
          const chartData = document.getElementById("chartData");
          const generateChartBtn = document.getElementById("generateChartBtn");

          if (chartType) {
            const options = chartType.querySelectorAll("option");
            if (options.length > 0) {
              options[0].textContent = aq.chooseChartType;
              if (options.length > 1) options[1].textContent = aq.barChart;
              if (options.length > 2) options[2].textContent = aq.pieChart;
              if (options.length > 3) options[3].textContent = aq.lineChart;
              if (options.length > 4) options[4].textContent = aq.radarChart;
            }
          }

          if (chartData) {
            const options = chartData.querySelectorAll("option");
            if (options.length > 0) {
              options[0].textContent = aq.chooseData;
              if (options.length > 1) options[1].textContent = aq.area;
              if (options.length > 2) options[2].textContent = aq.sector;
              if (options.length > 3) options[3].textContent = aq.population;
              if (options.length > 4) options[4].textContent = aq.damage;
            }
          }

          if (generateChartBtn) {
            const iconElement = generateChartBtn.querySelector("i");
            generateChartBtn.innerHTML = "";
            if (iconElement) generateChartBtn.appendChild(iconElement);
            generateChartBtn.appendChild(
              document.createTextNode(" " + aq.generateChart)
            );
          }

          // قسم التحليلات المتقدمة
          const advancedAnalysisTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(5) h4"
          );
          if (advancedAnalysisTitle)
            advancedAnalysisTitle.textContent = aq.advancedAnalysis;

          // أزرار التحليلات المتقدمة
          const densityAnalysisBtn =
            document.getElementById("densityAnalysisBtn");
          const infrastructureAnalysisBtn = document.getElementById(
            "infrastructureAnalysisBtn"
          );
          const serviceAccessAnalysisBtn = document.getElementById(
            "serviceAccessAnalysisBtn"
          );
          const damageAnalysisBtn =
            document.getElementById("damageAnalysisBtn");

          if (densityAnalysisBtn) {
            const iconElement = densityAnalysisBtn.querySelector("i");
            densityAnalysisBtn.innerHTML = "";
            if (iconElement) densityAnalysisBtn.appendChild(iconElement);
            densityAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.populationDensity)
            );
          }

          if (infrastructureAnalysisBtn) {
            const iconElement = infrastructureAnalysisBtn.querySelector("i");
            infrastructureAnalysisBtn.innerHTML = "";
            if (iconElement) infrastructureAnalysisBtn.appendChild(iconElement);
            infrastructureAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.infrastructure)
            );
          }

          if (serviceAccessAnalysisBtn) {
            const iconElement = serviceAccessAnalysisBtn.querySelector("i");
            serviceAccessAnalysisBtn.innerHTML = "";
            if (iconElement) serviceAccessAnalysisBtn.appendChild(iconElement);
            serviceAccessAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.serviceAccess)
            );
          }

          if (damageAnalysisBtn) {
            const iconElement = damageAnalysisBtn.querySelector("i");
            damageAnalysisBtn.innerHTML = "";
            if (iconElement) damageAnalysisBtn.appendChild(iconElement);
            damageAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.damageAnalysis)
            );
          }
        }

        // تحديث لوحة المعلومات إذا كانت مفتوحة
        const infoPanel = document.getElementById("info-panel");
        if (infoPanel) {
          // Update buttons text
          const cancelChangesBtn = document.getElementById("cancel-changes");
          const saveChangesBtn = document.getElementById("save-changes");

          if (cancelChangesBtn && t.cancelChanges) {
            cancelChangesBtn.textContent = t.cancelChanges;
          }

          if (saveChangesBtn && t.saveChanges) {
            saveChangesBtn.textContent = t.saveChanges;
          }

          // Refresh panel content if it's open
          if (infoPanel.classList.contains("show")) {
            const activeTab = document.querySelector(".tab-button.active");
            if (activeTab) {
              const tabId = activeTab.getAttribute("data-tab");
              if (tabId && selectedNeighborhoodId) {
                renderInfoPanel(tabId, selectedNeighborhoodId);
              }
            }
          }
        }
      }

      // Helper function to check if an element is inside a no-translate container
      function isInNoTranslateContainer(element) {
        let parent = element.parentElement;
        while (parent) {
          if (parent.classList && parent.classList.contains("no-translate")) {
            return true;
          }
          parent = parent.parentElement;
        }
        return false;
      }

      function toggleMenu() {
        const menu = document.getElementById("menuDropdown");
        menu.style.display = menu.style.display === "block" ? "none" : "block";
      }

      document.addEventListener("click", function (event) {
        const dropdown = document.querySelector(".menu-dropdown");
        if (dropdown && !dropdown.contains(event.target)) {
          document.getElementById("menuDropdown").style.display = "none";
        }
      });

      function logout() {
        // توجيه المستخدم إلى الصفحة الرئيسية
        window.location.href = "../index.html";
      }

      // تهيئة اللغة الافتراضية
      document.addEventListener("DOMContentLoaded", function () {
        // حذف اللغة المحفوظة أولاً لضمان استخدام الافتراضية
        localStorage.removeItem("selectedLanguage");
        // تعيين اللغة العربية كافتراضية
        localStorage.setItem("selectedLanguage", "ar");

        // Apply fixed styles to header and footer to prevent layout shifts
        document.querySelectorAll(".no-translate").forEach((element) => {
          element.style.direction = "rtl";

          // Make sure both titles are visible in the header
          if (element.id === "mainHeader") {
            const titleAr = element.querySelector(".title-ar");
            const titleEn = element.querySelector(".title-en");

            if (titleAr) titleAr.style.display = "block";
            if (titleEn) titleEn.style.display = "block";
          }
        });

        // تطبيق اللغة العربية
        switchLanguage("ar");

        // تحديث نص زر اللغة
        const langToggleBtn = document.getElementById("langToggleBtn");
        if (langToggleBtn) {
          langToggleBtn.textContent = "AR";
        }

        // تعيين اتجاه الصفحة إلى RTL
        document.documentElement.dir = "rtl";
        document.documentElement.lang = "ar";
      });

      document.addEventListener("DOMContentLoaded", function () {
        // Service Sectors Layer Checkbox
        const serviceSectorsCheckbox = document.getElementById(
          "layer-service-sectors"
        );
        if (serviceSectorsCheckbox) {
          serviceSectorsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("service-sectors", this.checked);
            }
          });
        }

        // Neighborhoods Layer Checkbox (optional, for consistency)
        const neighborhoodsCheckbox = document.getElementById(
          "layer-neighborhoods"
        );
        if (neighborhoodsCheckbox) {
          neighborhoodsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("neighborhoods", this.checked);
            }
          });
        }
      });

      function toggleLayersPanel() {
        var modal = document.getElementById("customLayersModal");
        if (modal.classList.contains("open")) {
          modal.classList.remove("open");
        } else {
          modal.classList.add("open");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Service Sectors Layer Checkbox
        const serviceSectorsCheckbox = document.getElementById(
          "layer-service-sectors"
        );
        if (serviceSectorsCheckbox) {
          serviceSectorsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("service-sectors", this.checked);
            }
          });
        }

        // Neighborhoods Layer Checkbox (optional, for consistency)
        const neighborhoodsCheckbox = document.getElementById(
          "layer-neighborhoods"
        );
        if (neighborhoodsCheckbox) {
          neighborhoodsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("neighborhoods", this.checked);
            }
          });
        }
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var tabs = document.querySelector(".tabs-container");
        if (tabs) {
          tabs.classList.remove("collapsed");
          tabs.style.display = "flex";
          tabs.style.visibility = "visible";
          tabs.style.opacity = "1";
          tabs.style.zIndex = "3000";
        }
      });
    </script>
  </body>
</html>
