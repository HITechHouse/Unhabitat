<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="shortcut icon"
      href="../../assets/img/UN_Habitat_Icon.svg"
      type="image/x-icon"
    />
    <title>City Map</title>

    <!-- Simplified Arabic Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    >

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Leaflet Map Core CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <!-- Leaflet Plugins CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"
    />

    <!-- Animation Library -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <!-- Material Design Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <!-- Application CSS -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/tabs.css" />
    <link rel="stylesheet" href="css/map_v2.css" />
    <link rel="stylesheet" href="css/auto-close.css" />
    <link rel="stylesheet" href="css/tabs-toggle.css" />

    <!-- Core Layout Styles -->
    <style>
      /* Pin Button Styles */
      .sidebar-pin {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: #ddd;
        cursor: pointer;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        padding: 0;
        border-radius: 4px;
        position: relative;
        margin: 0 8px;
        transition: all 0.3s ease;
      }

      .sidebar-pin:hover {
        background: rgba(255, 255, 255, 0.3);
        color: white;
      }

      .sidebar-pin.active {
        background: #4caf50;
        color: white;
      }

      .sidebar-pin.active:hover {
        background: #45a049;
      }

      /* Sidebar Animation Styles */
      .sidebar {
        transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1),
          opacity 0.4s ease, box-shadow 0.5s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        will-change: transform, opacity;
      }

      /* Improved sidebar toggle button animation */
      .sidebar-toggle {
        /* Restore original button properties */
        background: #2196f3;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        padding: 0;
        border-radius: 4px;
        position: relative;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);

        /* Add improved animation */
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
          background-color 0.3s ease, color 0.3s ease;
        will-change: transform;
      }

      /* Fix collapsed sidebar toggle button position */
      .sidebar.collapsed .sidebar-toggle {
        position: fixed;
        top: 45%;
        z-index: 1000;
      }

      .left-sidebar.collapsed .sidebar-toggle {
        left: 35px;
      }

      .right-sidebar.collapsed .sidebar-toggle {
        left: auto;
        right: 35px;
      }

      /* Improved hover effects */
      .left-sidebar .sidebar-toggle:hover {
        background-color: rgba(30, 64, 175, 1);
        transform: translateX(3px) rotate(-5deg);
      }

      .right-sidebar .sidebar-toggle:hover {
        background-color: rgba(30, 64, 175, 1);
        transform: translateX(-3px) rotate(5deg);
      }

      .left-sidebar {
        transform-origin: left center;
      }

      .right-sidebar {
        transform-origin: right center;
      }

      .sidebar.collapsed {
        opacity: 0.95;
        transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55),
          opacity 0.4s ease, box-shadow 0.4s ease;
        box-shadow: 0 0 0 rgba(0, 0, 0, 0);
        overflow: visible;
        /* Ensure toggle button remains visible */
      }

      .left-sidebar.collapsed {
        transform: translateX(-100%) scale(0.98);
      }

      .right-sidebar.collapsed {
        transform: translateX(100%) scale(0.98);
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Noto Naskh Arabic", sans-serif !important;
        box-sizing: border-box;
        overflow: hidden;
      }

      /* Fixed positioning for header and footer regardless of language direction */
      .no-translate {
        position: fixed !important;
        width: 100% !important;
        left: 0 !important;
        right: 0 !important;
      }

      /* Ensure elements inside no-translate containers maintain their position */
      .no-translate * {
        direction: inherit !important;
      }

      /* Override direction for specific elements that need to be translated */
      .no-translate .language-dropdown,
      .no-translate .menu-dropdown-content {
        direction: auto;
      }

      /* Header element positioning for RTL layout */
      #mainHeader .header-logos.right-logos {
        position: absolute !important;
        left: 20px !important;
        right: auto !important;
      }

      #mainHeader > div:first-child {
        position: absolute !important;
        right: 20px !important;
        left: auto !important;
      }

      #mainHeader .header-title {
        position: absolute !important;
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%) !important;
        width: auto !important;
        text-align: center !important;
      }

      /* Make both Arabic and English titles visible in the header */
      #mainHeader .title-ar,
      #mainHeader .title-en {
        display: block !important;
      }

      /* Header title styling */
      #mainHeader .header-title {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
      }

      #mainHeader .title-ar {
        font-size: 1.1rem !important;
        margin-bottom: 2px !important;
      }

      #mainHeader .title-en {
        font-size: 0.7rem !important;
        opacity: 0.9 !important;
      }

      /* Footer element positioning for RTL layout */
      #mainFooter .copyright {
        position: absolute !important;
        right: 20px !important;
        left: auto !important;
      }

      #mainFooter .social-icons {
        position: absolute !important;
        left: 20px !important;
        right: auto !important;
      }

      /* Positioning adjustments for LTR language direction */
      body[dir="ltr"] #mainHeader .header-logos.right-logos,
      body[dir="ltr"] #mainFooter .social-icons {
        right: 20px !important;
        left: auto !important;
      }

      body[dir="ltr"] #mainHeader > div:first-child,
      body[dir="ltr"] #mainFooter .copyright {
        left: 20px !important;
        right: auto !important;
      }

      /* Positioning adjustments for RTL language direction */
      body[dir="rtl"] #mainHeader .header-logos.right-logos,
      body[dir="rtl"] #mainFooter .social-icons {
        left: 20px !important;
        right: auto !important;
      }

      body[dir="rtl"] #mainHeader > div:first-child,
      body[dir="rtl"] #mainFooter .copyright {
        right: 20px !important;
        left: auto !important;
      }

      /* Header styling */
      #mainHeader {
        position: fixed;
        top: 0;
        width: 100%;
        height: 50px;
        background: #00b2e3;
        color: white;
        z-index: 1000;
        display: flex;
        align-items: center;
      }

      /* Footer styling */
      #mainFooter {
        position: fixed;
        bottom: 0;
        width: 100%;
        height: 50px;
        background: #00b2e3;
        color: white;
        z-index: 1000;
        display: flex;
        align-items: center;
      }

      .mainContent {
        /* position: absolute; */
        margin-top: 98px;
        left: 0;
        right: 0;
        bottom: 50px;
        width: 100%;
        overflow: hidden;
        background: #fff;
        box-sizing: border-box;
        display: flex;
        margin: 0;
        padding: 0;
        padding-top: 98px;
        /* Add padding to account for header and toolbar */
      }

      .main-content {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 0;
      }

      .map-container {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #map {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      /* Responsive adjustments if needed */
      @media (max-width: 600px) {
        #mainHeader,
        #mainFooter {
          height: 56px;
          font-size: 1rem;
        }

        .mainContent {
          top: 56px;
          height: calc(100vh - 112px);
        }
      }

      .header-logo {
        height: 40px;
        width: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
        object-fit: contain;
      }

      .header-title {
        flex: 1;
        text-align: center;
        font-weight: bold;
        font-size: 1.2rem;
        line-height: 1.4;
      }

      .header-logos {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 5px;
      }

      .header-logos img {
        height: 40px;
        width: 40px;
        object-fit: contain;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
      }

      .title-ar {
        font-size: 1.2rem;
        line-height: 1.4;
        font-weight: bold;
        white-space: normal;
      }

      .title-en {
        font-size: 1.22rem;
        line-height: 1.4;
        font-weight: bold;
        white-space: normal;
      }

      @media (max-width: 768px) {
        .title-en {
          display: none;
        }
      }

      .language-dropdown {
        position: relative;
      }

      .dots-button {
        background: none;
        border: none;
        font-size: 22px;
        cursor: pointer;
        color: white;
        padding: 5px;
      }

      .language-menu {
        position: absolute;
        top: 100%;
        left: 0;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 6px;
        display: none;
        flex-direction: column;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 2000;
        min-width: 60px;
      }

      .language-menu div {
        padding: 8px 12px;
        cursor: pointer;
        color: #333;
        font-weight: bold;
        text-align: center;
      }

      .language-menu div:hover {
        background-color: #f1f1f1;
      }

      .footer-content {
        margin: 0 auto;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 1rem;
        color: white;
      }

      .social-icon {
        color: #fff;
        font-size: 1.2rem;
        margin-left: 1rem;
        transition: color 0.3s ease;
      }

      .social-icon:hover {
        color: #3498db;
      }

      footer .copyright img {
        height: 40px;
        width: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
        background-color: white;
        padding: 2px;
        object-fit: contain;
        background-clip: content-box;
        vertical-align: middle;
        margin-right: 8px;
      }

      .footer-logo {
        height: 24px;
        margin-right: 8px;
        vertical-align: middle;
        display: inline-block !important;
      }

      .companyHITech {
        color: white !important;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .companyHITech:hover {
        color: #f0f0f0 !important;
        text-decoration: underline;
      }

      .info-panel {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: 450px;
        width: 85vw;
        max-height: 80vh;
        background: #fff;
        color: #222;
        border-radius: 12px;
        box-shadow: 0 5px 30px rgba(0, 0, 0, 0.25);
        z-index: 1500;
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        overflow: auto;
        transition: all 0.3s ease;
        display: none;
        /* Hide by default */
      }

      .info-panel.open,
      .info-panel.show {
        display: flex;
        /* Show when .open or .show is added */
      }

      .info-panel .close-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        cursor: pointer;
        font-size: 1.5rem;
        color: #666;
        background: rgba(240, 240, 240, 0.7);
        border: none;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        line-height: 1;
        transition: all 0.2s ease;
      }

      .info-panel .close-btn:hover {
        background: #e53e3e;
        color: white;
        transform: scale(1.1);
      }

      .info-panel h3 {
        font-size: 1.25rem;
        font-weight: bold;
        color: #1e40af;
        padding-bottom: 0.4rem;
        border-bottom: 2px solid #e5e7eb;
        text-align: center;
        width: 90%;
        margin-left: auto;
        margin-right: auto;
      }

      #infoPanelContent,
      #info-content {
        flex: 1 1 auto;
        overflow-y: auto;
        min-height: 50px;
        max-height: 60vh;
        padding: 0.3rem;
      }

      .modal-backdrop {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1400;
        -webkit-backdrop-filter: blur(2px);
        backdrop-filter: blur(2px);
      }

      .modal-backdrop.show {
        display: block;
      }

      /* Enhance info panel show/hide */
      .info-panel.show {
        animation: fadeInPanel 0.3s ease forwards;
      }

      @keyframes fadeInPanel {
        from {
          opacity: 0;
          transform: translate(-50%, -55%) scale(0.95);
        }

        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      /* جدول المعلومات */
      .info-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 0.75rem;
        direction: rtl;
        table-layout: fixed;
        border-radius: 6px;
        overflow: hidden;
      }

      .info-table tr {
        border-bottom: 1px solid #f0f0f0;
        transition: background-color 0.15s;
      }

      .info-table tr:last-child {
        border-bottom: none;
      }

      .info-table tr:hover {
        background-color: #f8fafc;
      }

      .info-table th {
        text-align: right;
        padding: 0.6rem 0.4rem;
        font-weight: 600;
        color: #1e40af;
        background-color: #f1f5f9;
      }

      .info-table td {
        padding: 0.5rem 0.4rem;
        vertical-align: middle;
      }

      .info-table td:first-child {
        font-weight: 600;
        color: #4b5563;
        width: 38%;
        border-left: 1px solid #f0f0f0;
        background-color: rgba(241, 245, 249, 0.3);
      }

      .info-table td:last-child {
        color: #111827;
        width: 62%;
      }

      /* أزرار لوحة المعلومات */
      .info-panel .button-group {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        margin-top: 0.4rem;
        padding: 0 0.25rem;
      }

      .info-panel .button-group button {
        flex: 1;
        padding: 0.5rem 0.8rem;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-family: "Noto Naskh Arabic", sans-serif;
        font-size: 0.9rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .info-panel #cancel-changes {
        display: none;
        background-color: #f3f4f6;
        color: #4b5563;
      }
      
      .info-panel #save-changes {
        display: none;
        background-color: #1e40af;
        color: white;
      }

      .info-panel #cancel-changes:hover {
        background-color: #e5e7eb;
        transform: translateY(-2px);
      }

      .info-panel #save-changes:hover {
        background-color: #1e3a8a;
        transform: translateY(-2px);
      }

      /* Additional styles for the form elements inside info-panel */
      .info-panel .editable-field {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        font-size: 0.9rem;
        transition: all 0.2s ease;
      }

      .info-panel .editable-field:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        outline: none;
      }

      .info-panel select.editable-field {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23555" d="M2 4l4 4 4-4z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 8px center;
        padding-right: 24px !important;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
      }

      .info-panel textarea.editable-field {
        min-height: 60px;
        resize: vertical;
      }

      /* Add subtle focus animation for the entire panel */
      .info-panel:focus-within {
        box-shadow: 0 8px 35px rgba(0, 0, 0, 0.28);
      }

      /* Close button animation */
      .info-panel .close-btn:active {
        transform: scale(0.9);
      }

      /* Responsive for mobile */
      @media (max-width: 600px) {
        .info-panel {
          top: 10px;
          transform: translate(-50%, 0);
          max-width: 90vw;
          max-height: 80vh;
          padding: 0.7rem;
          font-size: 0.95rem;
        }

        .info-panel h3 {
          font-size: 1.1rem;
          margin-top: 1rem;
        }

        .info-panel .button-group button {
          padding: 0.5rem 0.7rem;
          font-size: 0.8rem;
        }

        @keyframes fadeInPanel {
          from {
            opacity: 0;
            transform: translate(-50%, -5px) scale(0.95);
          }

          to {
            opacity: 1;
            transform: translate(-50%, 0) scale(1);
          }
        }
      }

      /* Custom Google Maps-like layers button in bottom left */
      .leaflet-bottom.leaflet-left .leaflet-control-layers {
        margin-left: 20px;
        margin-bottom: 80px;
        /* adjust as needed for your footer */
      }

      .leaflet-control-layers {
        border: none !important;
        background: none !important;
        box-shadow: none !important;
      }

      .leaflet-control-layers-toggle {
        width: 80px !important;
        height: 80px !important;
        border-radius: 16px !important;
        background: url("assets/img/cover.jfif") center center/cover no-repeat,
          #fff !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18) !important;
        border: 1px solid #e0e0e0 !important;
        display: flex !important;
        flex-direction: column;
        align-items: flex-end;
        justify-content: flex-end;
        position: relative;
        overflow: hidden;
        padding: 0;
      }

      :root {
        --layers-text: "الطبقات";
      }

      .leaflet-control-layers-toggle::after {
        content: var(--layers-text, "الطبقات");
        display: block;
        position: absolute;
        bottom: 8px;
        left: 0;
        right: 0;
        text-align: center;
        color: #fff;
        font-size: 1.1rem;
        font-weight: bold;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7);
        pointer-events: none;
        font-family: "Noto Naskh Arabic", sans-serif;
      }

      .leaflet-control-layers-toggle::before {
        content: "";
        display: block;
        position: absolute;
        bottom: 32px;
        left: 50%;
        transform: translateX(-50%);
        width: 32px;
        height: 32px;
        background: url('data:image/svg+xml;utf8,<svg fill="white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2L1 7l11 5 9.9-4.5L12 2zm0 7.7L3.6 7 12 3.3 20.4 7 12 9.7zm0 2.6l-8.4-3.7v2.1l8.4 3.7 8.4-3.7v-2.1l-8.4 3.7zm0 2.6l-8.4-3.7v2.1l8.4 3.7 8.4-3.7v-2.1l-8.4 3.7z"/></svg>')
          center center/contain no-repeat;
        pointer-events: none;
        opacity: 0.95;
      }

      .custom-layers-btn {
        position: absolute;
        bottom: 90px;
        left: 30px;
        width: 90px;
        height: 90px;
        border-radius: 16px;
        background: url("https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80")
            center center/cover no-repeat,
          #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        border: 1px solid #e0e0e0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        cursor: pointer;
        z-index: 1201;
        overflow: hidden;
        transition: box-shadow 0.2s, background 0.2s;
      }

      .custom-layers-btn:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.22);
      }

      .custom-layers-label {
        color: #fff;
        font-size: 1.1rem;
        font-weight: bold;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7);
        margin-bottom: 8px;
        font-family: "Noto Naskh Arabic", sans-serif;
        pointer-events: none;
      }

      .custom-layers-icon {
        margin-bottom: 18px;
        pointer-events: none;
      }

      .custom-layers-modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.25);
        align-items: center;
        justify-content: center;
      }

      .custom-layers-modal.open {
        display: flex;
      }

      .custom-layers-modal-content {
        background: #fff;
        border-radius: 16px;
        padding: 2rem 2.5rem;
        min-width: 260px;
        max-width: 90vw;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
        position: relative;
        text-align: center;
      }

      .custom-layers-modal-close {
        position: absolute;
        top: 10px;
        left: 16px;
        font-size: 2rem;
        color: #888;
        cursor: pointer;
        font-weight: bold;
      }

      .gmaps-base-btn {
        position: absolute;
        bottom: 90px;
        left: 30px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1201;
        transition: box-shadow 0.2s, background 0.2s;
        outline: none;
      }

      .gmaps-base-btn:hover {
        background: #f5f5f5;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.22);
      }

      .gmaps-base-icon {
        pointer-events: none;
      }

      .tabs-toggle-btn-container {
        display: none;
        /* Hide the old container completely */
      }

      .footer-center-btn {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 2002;
      }

      .tabs-toggle-btn {
        background: #3066ff;
        color: #fff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        font-size: 1.4rem;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
      }

      .tabs-toggle-btn:hover {
        background: #ff4f30;
      }
    </style>
    <style>
      .hero {
        position: relative;
        height: 100vh;
        color: #fff;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        background-color: #1e293b;
      }

      #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      .hero-content {
        position: relative;
        z-index: 2;
        max-width: 800px;
        padding: 2rem;
      }

      .hero-subtitle {
        font-size: 1.25rem;
        margin-bottom: 2rem;
        line-height: 1.8;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        margin: 0.5rem;
        border-radius: 50px;
        font-size: 1rem;
        text-decoration: none;
        transition: background 0.3s ease;
        display: inline-block;
      }

      .btn-primary {
        background-color: #3b82f6;
        color: #fff;
      }

      .btn-primary:hover {
        background-color: #2563eb;
      }

      .btn-secondary {
        background-color: #e5e7eb;
        color: #1f2937;
      }

      .btn-secondary:hover {
        background-color: #d1d5db;
      }

      .stats {
        margin-top: 2rem;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 2rem;
        color: #fff;
      }

      .stat {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem 2rem;
        border-radius: 1rem;
        -webkit-backdrop-filter: blur(5px);
        backdrop-filter: blur(5px);
        min-width: 150px;
      }

      .stat h3 {
        font-size: 2rem;
        margin: 0;
      }

      .stat p {
        margin: 0;
        font-size: 1rem;
      }

      .hero-carousel {
        position: relative;
        height: 100vh;
        overflow: hidden;
        font-family: "Noto Naskh Arabic", sans-serif;
      }

      .carousel-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
      }

      .carousel-track {
        display: flex;
        height: 100%;
        width: 100%;
        transition: transform 0.5s ease;
      }

      .carousel-slide {
        min-width: 100%;
        height: 100%;
        flex-shrink: 0;
        background-size: cover;
        background-position: center;
        position: relative;
      }

      .overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.6),
          rgba(0, 0, 0, 0.1)
        );
        z-index: 1;
      }

      .slide-content {
        font-size: 2.2rem;
        margin-bottom: 500px;
        font-weight: 700;
        color: white;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      }

      .slide-content h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
      }

      .slide-content p {
        font-size: 1.2rem;
        line-height: 1.6;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
      }

      .slide-content .btn {
        margin: 0.5rem;
        padding: 0.75rem 1.5rem;
        border-radius: 30px;
        font-weight: bold;
        text-decoration: none;
        transition: 0.3s;
      }

      .btn-primary {
        background-color: #3b82f6;
        color: #fff;
      }

      .btn-secondary {
        background-color: #f3f4f6;
        color: #1f2937;
      }

      .btn-primary:hover {
        background-color: #2563eb;
      }

      .btn-secondary:hover {
        background-color: #e5e7eb;
      }

      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(255, 255, 255, 0.3);
        border: none;
        color: white;
        font-size: 2rem;
        padding: 0.5rem 1rem;
        cursor: pointer;
        z-index: 5;
        transition: 0.3s;
      }

      .carousel-btn:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }

      .carousel-btn.prev {
        left: 15px;
      }

      .carousel-btn.next {
        right: 15px;
      }

      #mainContent {
        flex: 1;
        width: 100%;
        height: calc(100vh - 120px);
        margin: 0;
        padding: 0;
        position: relative;
      }

      .swiper-container {
        width: 100%;
        height: 100%;
      }

      .swiper-slide {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .swiper-slide > div {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      body[dir="ltr"] .header-title {
        text-align: center;
      }

      body[dir="ltr"] .header-logos.right-logos {
        margin-left: auto;
      }

      body[dir="ltr"] .language-menu {
        left: auto;
        right: 0;
      }

      body[dir="ltr"] .social-icon {
        margin-left: 0;
        margin-right: 1rem;
      }

      body[dir="ltr"] .footer-content {
        direction: ltr;
      }

      body[dir="ltr"] .footer-logo {
        margin-right: 0;
        margin-left: 8px;
      }

      body[dir="ltr"] .copyright-text {
        direction: ltr;
      }

      body[dir="ltr"] .slide-content {
        text-align: center;
      }
    </style>
    <style>
      .tabs-container {
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%);
        width: 85% !important;
        max-width: 85vw !important;
        position: fixed !important;
        bottom: 50px !important;
        z-index: 2001 !important;
        border-radius: 12px 12px 0 0;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      /* إصلاح لعرض التبويبات في كلا اللغتين */
      body[dir="rtl"] .tabs-container,
      body[dir="ltr"] .tabs-container {
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%);
      }

      /* حالات الظهور والاختفاء للتبويبات */
      .tabs-container.visible {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
        visibility: visible;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
      }

      .tabs-container.hidden {
        opacity: 0;
        transform: translateX(-50%) translateY(100px);
        visibility: hidden;
        pointer-events: none;
      }

      .tabs-header {
        display: flex;
        gap: 4px;
        padding: 6px;
      }

      .tab-button {
        display: flex;
        align-items: center;
        background: #e0e0e0;
        color: #333;
        border: none;
        border-radius: 8px 8px 0 0;
        padding: 6px 4px;
        font-size: 10px;
        position: relative;
        cursor: pointer;
        transition: background 0.3s;
      }

      .tab-button.active {
        background: #ffffff;
        border-bottom: 2px solid #007bff;
        font-weight: bold;
      }

      .tab-button:hover {
        background: #d0d0d0;
      }

      .tab-icon {
        margin-left: 6px;
        color: #007bff;
      }

      .tab-close:hover {
        color: red;
      }
    </style>
    <style>
      .menu-dropdown {
        position: relative;
        display: inline-block;
      }

      .menu-toggle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.7);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 1.2rem;
      }

      .menu-toggle:hover {
        background: rgba(255, 255, 255, 0.32);
        transform: scale(1.05);
      }

      .menu-dropdown-content {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background-color: white;
        min-width: 160px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        z-index: 1000;
        margin-top: 5px;
      }

      .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        text-decoration: none;
        color: #333;
        transition: background-color 0.3s ease;
        font-size: 0.9rem;
      }

      .menu-item i {
        margin-left: 8px;
        width: 20px;
        text-align: center;
        font-size: 1rem;
      }

      .menu-item:hover {
        background-color: #f5f5f5;
      }

      body[dir="ltr"] .menu-dropdown-content {
        right: auto;
        left: 0;
      }

      body[dir="ltr"] .menu-item i {
        margin-left: 0;
        margin-right: 8px;
      }

      .language-toggle {
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
        font-weight: bold;
        font-size: 1.1rem;
        border: 2px solid rgba(255, 255, 255, 0.7);
        outline: none;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: background 0.2s, border 0.2s, box-shadow 0.2s;
      }

      .language-toggle:hover {
        background: rgba(255, 255, 255, 0.32);
        border-color: #fff;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        color: #007bff;
      }

      /* تحسين مظهر الهيدر */
      #mainHeader {
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        background-color: #00b2e3;
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        height: 50px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header-title {
        flex: 1;
        text-align: center;
        font-weight: bold;
        font-size: 1.2rem;
        line-height: 1.4;
      }

      .header-logo {
        height: 40px;
        width: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
        object-fit: contain;
      }

      .header-logos {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 5px;
      }

      .header-logos img {
        height: 40px;
        width: 40px;
        object-fit: contain;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
      }

      .header-back-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        cursor: pointer;
        margin-left: 4px;
        transition: all 0.3s;
      }

      .header-back-btn:hover {
        background: rgba(255, 255, 255, 0.32);
        color: #007bff;
        border-color: #fff;
        transform: scale(1.08);
      }

      .header-back-btn i {
        font-size: 1.3rem;
      }
    </style>
    <!-- Map Toolbar CSS -->
    <style>
      /* Map control buttons container */

      .map-toolbar {
        position: fixed;
        top: 60px;
        right: 50%;
        transform: translateX(50%);
        z-index: 1202;
        display: flex;
        flex-direction: row;
        gap: 10px;
        background-color: rgba(255, 255, 255, 0.7);
        padding: 5px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }

      .map-toolbar button {
        background: #2196f3;
        color: #fff;
        border: none;
        border-radius: 4px;
        width: 36px;
        height: 36px;
        font-size: 1.1rem;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        transition: background 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Hover effect for map controls */
      .map-toolbar button:hover {
        background: #1769aa;
      }

      /* Basemap thumbnail styles */
      .basemap-thumb {
        display: inline-block !important;
        margin: 5px !important;
        cursor: pointer !important;
        transition: transform 0.2s !important;
      }

      /* Selected and hover states for basemap thumbnails */
      .basemap-thumb:hover {
        transform: scale(1.05) !important;
      }

      /* Basemap thumbnail images */
      .basemap-thumb img {
        width: 80px !important;
        height: 80px !important;
        object-fit: cover !important;
        border-radius: 8px !important;
        border: 3px solid #eee !important;
      }

      /* Selected state for basemap thumbnails */
      .basemap-thumb.selected img {
        border-color: #2196f3 !important;
      }

      /* Compass indicator in bottom right corner */
      .map-compass {
        position: fixed;
        right: 20px;
        bottom: 60px;
        width: 48px;
        height: 48px;
        z-index: 999;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        display: flex !important;
        align-items: center;
        justify-content: center;
        padding: 4px;
        visibility: visible !important;
        z-index: 1500 !important;
        pointer-events: auto !important;
      }

      /* Compass image styling */
      .map-compass img {
        width: 36px;
        height: 36px;
      }

      /* Ensure consistent toolbar layout regardless of language */
      body[dir="rtl"] .map-toolbar,
      body[dir="ltr"] .map-toolbar {
        direction: rtl !important;
        right: 50%;
        transform: translateX(50%);
      }
    </style>
    <!-- Leaflet Measure CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-measure/dist/leaflet-measure.css"
    />
    <!-- Tab Toggle Button Styles -->
    <style>
      /* Container for tabs toggle button (centered at bottom) */
      .tabs-toggle-btn-container {
        display: none;
        /* Hide the old container completely */
      }

      .footer-center-btn {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 2002;
      }

      .tabs-toggle-btn {
        background: #3066ff;
        color: #fff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        font-size: 1.4rem;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
      }

      .tabs-toggle-btn:hover {
        background: #ff4f30;
      }
    </style>
    <!-- Compass (bottom right) -->
    <div class="map-compass" title="North">
      <img src="assets/img/map-compass.jpg" alt="Compass North" />
    </div>
    <!-- Basemap and Compass Styles -->
    <style>
      /* Basemap thumbnail styling */
      .basemap-thumb img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #eee;
        background: #f8f8f8;
      }

      /* Selected state for basemap thumbnails */
      .basemap-thumb.selected img {
        border: 2px solid #3066ff;
      }

      /* Basemap labels */
      .basemap-label {
        text-align: center;
        font-size: 12px;
        margin-top: 4px;
        color: #222;
      }

      /* Compass indicator in bottom right corner */
      .map-compass {
        position: fixed;
        right: 20px;
        bottom: 60px;
        width: 48px;
        height: 48px;
        z-index: 999;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4px;
      }

      /* Compass image styling */
      .map-compass img {
        width: 36px;
        height: 36px;
      }
    </style>
    <!-- Measurement Type Modal -->
    <div
      id="measure-type-modal"
      class="measure-type-modal"
      style="display: none"
    >
      <div class="measure-type-content">
        <h3>اختر نوع القياس</h3>
        <button id="measure-distance-btn" class="measure-type-btn">
          قياس مسافة
        </button>
        <button id="measure-area-btn" class="measure-type-btn">
          قياس مساحة
        </button>
        <button
          id="measure-cancel-btn"
          class="measure-type-btn"
          style="background-color: rgba(93, 97, 103, 0.5)"
        >
          إلغاء
        </button>
      </div>
    </div>
    <!-- Measurement Modal Styles -->
    <style>
      /* Measurement type selection modal overlay */
      .measure-type-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.25);
        z-index: 3000;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Modal content container */
      .measure-type-content {
        background: #fff;
        border-radius: 12px;
        padding: 2rem 2.5rem 1.5rem 2.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
        text-align: center;
        min-width: 220px;
      }

      /* Modal title */
      .measure-type-content h3 {
        margin-bottom: 1.2rem;
        color: #1e40af;
        font-size: 1.2rem;
      }

      /* Measurement action buttons */
      .measure-type-btn {
        background: #2196f3;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0.7rem 1.5rem;
        margin: 0 0.5rem 0.5rem 0.5rem;
        font-size: 1rem;
        cursor: pointer;
        font-family: "Noto Naskh Arabic", sans-serif;
        transition: background 0.2s;
      }

      /* Hover effect for measurement buttons */
      .measure-type-btn:hover {
        background: #1769aa;
      }
    </style>
    <!-- Measurement Result Floating Box -->
    <div
      id="measure-result-box"
      class="measure-result-box"
      style="display: none"
    ></div>
    <!-- Measurement Result Box Styles -->
    <style>
      /* Floating box to display measurement results */
      .measure-result-box {
        position: fixed;
        top: 105px;
        right: 20px;
        background: #fff;
        color: #1e40af;
        border-radius: 10px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.18);
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        font-weight: bold;
        z-index: 3001;
        min-width: 120px;
        text-align: center;
        border: 2px solid #2196f3;
        transition: opacity 0.3s;
      }
    </style>
    <!-- html2canvas for screenshot -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- After jsPDF script import -->
    <!-- Add CSS to preserve direction for map-toolbar and tabs-container -->
    <style>
      /* Prevent direction changes for map-toolbar and tabs-container */
      .map-toolbar,
      .tabs-container {
        direction: rtl !important;
        /* Force RTL direction always */
      }

      /* Fix for icon alignment in map toolbar buttons */
      .map-toolbar button i {
        margin: 0;
      }

      /* Fix for tab buttons alignment */
      .tab-button {
        flex-direction: row !important;
        /* Force row direction */
      }

      .tab-icon {
        margin-left: 6px !important;
        margin-right: 0 !important;
        color: #007bff;
      }

      /* Override any language-specific direction changes */
      body[dir="ltr"] .map-toolbar,
      body[dir="ltr"] .tabs-container {
        direction: rtl !important;
      }

      /* Ensure icons maintain position in both languages */
      body[dir="ltr"] .tab-icon {
        margin-left: 6px !important;
        margin-right: 0 !important;
      }

      /* Full Screen Popup Styles */
      .fullscreen-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        display: none;
        opacity: 0;
        transition: opacity 0.4s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
      }

      .fullscreen-popup.show {
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 1;
      }

      .fullscreen-popup-content {
        background: #fff;
        width: 95vw;
        height: 90vh;
        border-radius: 16px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        transform: scale(0.8) translateY(50px);
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .fullscreen-popup.show .fullscreen-popup-content {
        transform: scale(1) translateY(0);
      }

      .fullscreen-popup-close {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        color: #666;
        cursor: pointer;
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .fullscreen-popup-close:hover {
        background: #e53e3e;
        color: white;
        transform: scale(1.1) rotate(90deg);
      }

      .fullscreen-popup-body {
        padding: 10px;
        height: 100%;
        overflow: hidden;
        font-family: "Noto Naskh Arabic", sans-serif;
        display: flex;
        flex-direction: column;
      }

      .popup-loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #4b5563;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .popup-content-container {
        height: 100%;
        overflow: hidden;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .popup-content-container .container-fluid {
        height: 100%;
        padding: 0;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .popup-content-container .row {
        height: 100%;
        margin: 0;
        flex: 1;
        display: flex;
        align-items: stretch;
      }

      .popup-content-container .col-md-4,
      .popup-content-container .col-md-8 {
        display: flex;
        flex-direction: column;
        padding: 5px;
      }

      .popup-content-container .section-container {
        margin: 0;
        height: 100%;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .popup-content-container .scrollable-sliders {
        flex: 1;
        overflow-y: auto;
        max-height: none;
      }

      .popup-content-container canvas {
        max-width: 100% !important;
        max-height: 100% !important;
        height: auto !important;
      }

      .popup-content-container .col-md-8 .section-container {
        align-items: center;
        justify-content: center;
      }

      /* Animation for popup entrance */
      @keyframes popupSlideIn {
        from {
          opacity: 0;
          transform: scale(0.7) translateY(100px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* Responsive design for smaller screens */
      @media (max-width: 768px) {
        .fullscreen-popup-content {
          width: 95vw;
          height: 90vh;
          border-radius: 12px;
        }

        .fullscreen-popup-body {
          padding: 50px 20px 20px 20px;
        }

        .fullscreen-popup-close {
          top: 15px;
          left: 15px;
          width: 40px;
          height: 40px;
          font-size: 1.2rem;
        }

        .popup-content-container .row {
          flex-direction: column;
        }

        .popup-content-container .col-md-4,
        .popup-content-container .col-md-8 {
          padding: 5px;
        }

        .popup-content-container .col-md-4 {
          max-height: 40%;
        }

        .popup-content-container .col-md-8 {
          flex: 1;
        }
      }
    </style>
  </head>

  <body>
    <!-- Header -->
    <header id="mainHeader" class="no-translate">
      <div style="display: flex; align-items: center; gap: 10px">
        <img
          src="assets/img/unhabitat.jfif"
          alt="Logo 3"
          class="header-logo"
          onclick="window.location.href='../admin.html'"
          style="cursor: pointer"
        />

        <div class="language-dropdown">
          <button
            class="language-toggle"
            id="langToggleBtn"
            onclick="toggleLanguage()"
          >
            AR
          </button>
        </div>
        <div class="menu-dropdown">
          <button
            title="menu toggle btn"
            class="menu-toggle"
            id="menuToggleBtn"
            onclick="toggleMenu()"
            style="background-image: url('../../assets/img/user1.jpg'); background-size: cover; background-position: center;"
          >
          </button>
          <div class="menu-dropdown-content" id="menuDropdown">
            <a href="#" class="menu-item" id="settingsBtn">
              <i class="fas fa-cog"></i>
              <span id="settingsText">الإعدادات</span>
            </a>
            <a href="#" class="menu-item" id="logoutBtn" onclick="logout()">
              <i class="fas fa-sign-out-alt"></i>
              <span id="logoutText">تسجيل الخروج</span>
            </a>
          </div>
        </div>
      </div>

      <div class="header-title text-center">
        <div class="title-ar">نظام إدارة المعلومات الحضرية _ مدينة حلب</div>
        <div class="title-en">
          Urban Information Management System - Aleppo City
        </div>
      </div>

      <div class="header-logos right-logos">
        <img
          src="assets/img/aleppo.jfif"
          alt="Logo 1"
          class="header-logo"
        />
        <img
          src="assets/img/japan.png"
          alt="Logo 2"
          class="header-logo"
        />
      </div>
    </header>

    <div class="mainContent">
      <div class="main-content">
        <div class="map-container">
          <div class="tabs-container"></div>

          <!-- Map Toolbar -->
          <div class="map-toolbar">
            <button id="zoom-in-btn" title="Zoom In">
              <i class="fas fa-search-plus"></i>
            </button>
            <button id="zoom-out-btn" title="Zoom Out">
              <i class="fas fa-search-minus"></i>
            </button>
            <button id="home-btn" title="Home">
              <i class="fas fa-home"></i>
            </button>
            <button id="layers-btn" title="Basemap Gallery">
              <i class="fas fa-layer-group"></i>
            </button>
            <button id="measure-btn" title="Measure">
              <i class="fas fa-ruler"></i>
            </button>
            <button id="draw-btn" title="Draw">
              <i class="fas fa-pencil-alt"></i>
            </button>
            <button id="printMapBtn" title="Print Map">
              <i class="fas fa-print"></i>
            </button>
            <button id="tabsToggleBtn" title="Toggle Tabs">
              <!-- <i class="fas fa-layer-group"></i> -->
              <i class="fa-solid fa-table-columns"></i>
            </button>
            <button id="fullscreen-popup-btn" title="Composite urban efficiency">
              <i class="fas fa-sliders"></i>
            </button>
          </div>
          <!-- Basemap Gallery Modal -->
          <div
            id="basemap-gallery"
            class="basemap-gallery-modal"
            style="
              display: none;
              position: fixed;
              left: 20px;
              bottom: 130px;
              background: white;
              border-radius: 10px;
              padding: 15px;
              z-index: 10000 !important;
              box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
              width: 250px;
            "
          >
            <div
              style="font-weight: bold; margin-bottom: 10px; text-align: center"
            >
              اختر الخريطة الأساسية
            </div>
            <div
              style="
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
              "
            >
              <!-- Basemap options with inline icons -->
              <div
                class="basemap-thumb"
                data-basemap="osm"
                style="cursor: pointer; transition: transform 0.2s; margin: 5px"
              >
                <div
                  style="
                    width: 80px;
                    height: 80px;
                    background-color: #e6e6e6;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 8px;
                    border: 3px solid #ddd;
                  "
                >
                  <i
                    class="fas fa-map"
                    style="font-size: 28px; color: #7a7a7a"
                  ></i>
                </div>
                <div
                  class="basemap-label"
                  style="text-align: center; font-size: 12px; margin-top: 4px"
                >
                  خريطة الشارع
                </div>
              </div>
              <div
                class="basemap-thumb"
                data-basemap="satellite"
                style="cursor: pointer; transition: transform 0.2s; margin: 5px"
              >
                <div
                  style="
                    width: 80px;
                    height: 80px;
                    background-color: #2d2d2d;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 8px;
                    border: 3px solid #ddd;
                  "
                >
                  <i
                    class="fas fa-satellite"
                    style="font-size: 28px; color: #ffffff"
                  ></i>
                </div>
                <div
                  class="basemap-label"
                  style="text-align: center; font-size: 12px; margin-top: 4px"
                >
                  أقمار صناعية
                </div>
              </div>
              <div
                class="basemap-thumb"
                data-basemap="terrain"
                style="cursor: pointer; transition: transform 0.2s; margin: 5px"
              >
                <div
                  style="
                    width: 80px;
                    height: 80px;
                    background-color: #c5e8c5;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 8px;
                    border: 3px solid #ddd;
                  "
                >
                  <i
                    class="fas fa-mountain"
                    style="font-size: 28px; color: #4a6741"
                  ></i>
                </div>
                <div
                  class="basemap-label"
                  style="text-align: center; font-size: 12px; margin-top: 4px"
                >
                  تضاريس
                </div>
              </div>
              <div
                class="basemap-thumb"
                data-basemap="dark"
                style="cursor: pointer; transition: transform 0.2s; margin: 5px"
              >
                <div
                  style="
                    width: 80px;
                    height: 80px;
                    background-color: #121212;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 8px;
                    border: 3px solid #ddd;
                  "
                >
                  <i
                    class="fas fa-moon"
                    style="font-size: 28px; color: #ffffff"
                  ></i>
                </div>
                <div
                  class="basemap-label"
                  style="text-align: center; font-size: 12px; margin-top: 4px"
                >
                  داكن
                </div>
              </div>
            </div>
          </div>
          <!-- Compass (bottom right) -->
          <div class="map-compass" title="الشمال">
            <img src="assets/img/map-compass.jpg" alt="Compass North" />
          </div>

          <!-- Full Screen Popup Window -->
          <div id="fullscreen-popup" class="fullscreen-popup">
            <div class="fullscreen-popup-content">
              <button id="fullscreen-popup-close" class="fullscreen-popup-close">
                <i class="fas fa-times"></i>
              </button>
              <div class="fullscreen-popup-body">
                <div id="popup-loading" class="popup-loading">
                  <div class="loading-spinner"></div>
                  <p>جاري التحميل...</p>
                </div>
                <div id="popup-content-container" class="popup-content-container" style="display: none;">
                  <!-- Content from window.html will be loaded here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Map Toolbar CSS -> REMOVED DUPLICATE STYLES HERE -->
          <div id="map"></div>
          <div class="tab-content">
            <!-- Tab content will be dynamically added here -->
          </div>

          <!-- Info Panel -->
          <div id="modal-backdrop" class="modal-backdrop"></div>
          <div id="info-panel" class="info-panel">
            <button id="close-info-panel" class="close-btn">&times;</button>
            <h3 id="info-title"></h3>
            <div id="info-content"></div>
          </div>

          <style>
            .modal-backdrop {
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1400;
              -webkit-backdrop-filter: blur(2px);
              backdrop-filter: blur(2px);
            }

            .modal-backdrop.show {
              display: block;
            }

            /* Enhance info panel show/hide */
            .info-panel.show {
              animation: fadeInPanel 0.3s ease forwards;
            }

            @keyframes fadeInPanel {
              from {
                opacity: 0;
                transform: translate(-50%, -55%) scale(0.95);
              }

              to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
              }
            }
          </style>
        </div>
      </div>

      <!-- Left Sidebar - Layers Management -->
      <aside
        id="leftSidebar"
        class="sidebar left-sidebar"
        style="margin-top: -10px"
      >
      <div class="sidebar-header">
        <button title="sidebar toggle" id="toggleLeftSidebar" class="sidebar-toggle">
          <i class="fas fa-chevron-right"></i>
        </button>
        <button id="pinLeftSidebar" class="sidebar-pin" title="تثبيت القائمة">
          <i class="fas fa-thumbtack"></i>
        </button>
        <h3>إدارة الطبقات</h3>
      </div>
        <!-- Indicador de cierre automático -->
        <div id="leftSidebarAutoCloseIndicator" class="auto-close-indicator">
          <span class="auto-close-countdown"></span>
          <span>سيتم الإغلاق تلقائيًا</span>
        </div>
        <div class="sidebar-content" style="margin-bottom: 110px">
          <!-- Base Layers Section -->

          <div class="sidebar-section">
            <h4>الطبقات</h4>
            <div id="layersList" class="layer-list">
              <!-- Layers will be populated dynamically -->
              <div class="layer-item">
                <div class="layer-toggle">
                  <input type="checkbox" id="layer-neighborhoods" checked />
                  <label for="layer-neighborhoods">الأحياء</label>
                </div>
                <div class="layer-actions">
                  <button
                    title="layer action btn"
                    class="layer-action-btn"
                    data-action="zoom"
                    data-layer="neighborhoods"
                  >
                    <i class="fas fa-search-plus"></i>
                  </button>
                  <button
                    title="layer action btn"
                    class="layer-action-btn"
                    data-action="info"
                    data-layer="neighborhoods"
                  >
                    <i class="fas fa-info-circle"></i>
                  </button>
                </div>
              </div>
              <div class="layer-item">
                <div class="layer-toggle">
                  <input type="checkbox" id="layer-service-sectors" checked />
                  <label for="layer-service-sectors">دوائر الخدمات</label>
                </div>
                <div class="layer-actions">
                  <button
                    type="button"
                    title="Zoom to Service Sectors"
                    class="layer-action-btn"
                    data-action="zoom"
                    data-layer="service-sectors"
                  >
                    <i class="fas fa-search-plus"></i>
                  </button>
                  <button
                    title="layer action btn"
                    class="layer-action-btn"
                    data-action="info"
                    data-layer="service-sectors"
                  >
                    <i class="fas fa-info-circle"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="sidebar-section">
            <h4 class="sidebar-section-title">
              <i class="fas fa-map sidebar-icon"></i>
              الخرائط الأساسية
            </h4>
            <div id="baseLayers" class="base-layers">
              <div class="base-layer-option" data-basemap="osm">
                <input type="radio" name="basemap" id="osm" checked />
                <label for="osm" class="mr-2">خريطة الشارع المفتوحة</label>
              </div>
              <div class="base-layer-option" data-basemap="satellite">
                <input type="radio" name="basemap" id="satellite" />
                <label for="satellite" class="mr-2">صور الأقمار الصناعية</label>
              </div>
              <div class="base-layer-option" data-basemap="terrain">
                <input type="radio" name="basemap" id="terrain" />
                <label for="terrain" class="mr-2">التضاريس</label>
              </div>
            </div>
          </div>
          <div class="sidebar-section">
            <h4>تصدير / استيراد</h4>
            <div class="import-export-controls">
              <button id="importLayerBtn" class="sidebar-button">
                <i class="fas fa-file-import"></i> استيراد طبقة
              </button>
              <input
                type="file"
                id="layerFileInput"
                accept=".geojson,.kml,.shp,.zip"
                style="display: none"
              />

              <button id="exportLayerBtn" class="sidebar-button">
                <i class="fas fa-file-export"></i> تصدير طبقة
              </button>

              <button id="printMapBtn" class="sidebar-button">
                <i class="fas fa-print"></i> طباعة الخريطة
              </button>

              <div class="layer-selector">
                <label for="exportLayerSelect">اختر الطبقة:</label>
                <select id="exportLayerSelect" class="sidebar-select">
                  <option value="neighborhoods">الأحياء</option>
                  <option value="service-sectors">القطاعات الخدمية</option>
                  <option value="neighborhood-labels">مسميات الأحياء</option>
                </select>
              </div>

              <div class="format-selector">
                <label for="exportFormat">صيغة التصدير:</label>
                <select id="exportFormat" class="sidebar-select">
                  <option value="geojson">GeoJSON</option>
                  <option value="kml">KML</option>
                  <option value="shp">Shapefile (ZIP)</option>
                  <option value="csv">CSV</option>
                </select>
              </div>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>الرموز والألوان</h4>
            <div id="symbolEditor" class="symbol-editor">
              <select
                title="choose layer"
                id="layerStyleSelect"
                class="sidebar-select"
              >
                <option value="">اختر طبقة...</option>
                <option value="neighborhoods">الأحياء</option>
                <option value="service-sectors">دوائر الخدمات</option>
              </select>

              <div class="style-options" id="styleOptions">
                <div class="style-option">
                  <label>اللون:</label>
                  <input
                    title="color"
                    type="color"
                    id="layerColor"
                    value="#1e40af"
                  />
                </div>

                <div class="style-option">
                  <label>الشفافية:</label>
                  <input
                    title="transparency"
                    type="range"
                    id="layerOpacity"
                    min="0"
                    max="1"
                    step="0.1"
                    value="0.8"
                  />
                  <span id="opacityValue">0.8</span>
                </div>

                <div class="style-option">
                  <label>سمك الخط:</label>
                  <input
                    title="line weight"
                    type="number"
                    id="lineWeight"
                    min="1"
                    max="10"
                    value="2"
                  />
                </div>

                <button id="applyStyleBtn" class="sidebar-button">
                  <i class="fas fa-check"></i> تطبيق
                </button>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Right Sidebar - Analysis and Queries -->
      <aside
        id="rightSidebar"
        class="sidebar right-sidebar"
        style="margin-top: -10px"
      >
        <div class="sidebar-header">
          <h3>التحليلات والاستعلامات</h3>
          <button
            id="pinRightSidebar"
            class="sidebar-pin"
            title="تثبيت القائمة"
          >
            <i class="fas fa-thumbtack"></i>
          </button>
          <button
            title="toggle right sidebar"
            id="toggleRightSidebar"
            class="sidebar-toggle"
          >
            <i class="fas fa-chevron-left"></i>
          </button>
        </div>
        <!-- Indicador de cierre automático -->
        <div id="rightSidebarAutoCloseIndicator" class="auto-close-indicator">
          <span class="auto-close-countdown"></span>
          <span>سيتم الإغلاق تلقائيًا</span>
        </div>
        <div class="sidebar-content" style="margin-bottom: 85px">
          <div class="sidebar-section">
            <h4>منشئ الاستعلامات</h4>
            <div id="queryBuilder" class="query-builder">
              <div class="query-builder-row">
                <select
                  title="query table select"
                  id="queryTableSelect"
                  class="sidebar-select"
                >
                  <option value="">اختر طبقة...</option>
                  <option value="neighborhoods">الأحياء</option>
                  <option value="service-sectors">دوائر الخدمات</option>
                </select>
              </div>

              <div class="query-builder-row">
                <select
                  title="query field select"
                  id="queryFieldSelect"
                  class="sidebar-select"
                >
                  <option value="">اختر حقل...</option>
                </select>
              </div>

              <div class="query-builder-row">
                <select
                  title="query operator select"
                  id="queryOperatorSelect"
                  class="sidebar-select"
                >
                  <option value="">اختر العملية...</option>
                  <option value="=">=</option>
                  <option value="<>">≠</option>
                  <option value=">">></option>
                  <option value="<"><< /option></option>

                  <option value=">=">≥</option>
                  <option value="<=">≤</option>
                  <option value="like">يحتوي</option>
                </select>
              </div>

              <div class="query-builder-row">
                <div class="value-input-container">
                  <input
                    type="text"
                    id="queryValueInput"
                    class="sidebar-input"
                    placeholder="أدخل القيمة"
                  />
                  <button
                    title="value list btn"
                    id="valueListBtn"
                    class="sidebar-button small-button"
                  >
                    <i class="fas fa-list"></i>
                  </button>
                </div>
              </div>

              <button id="addConditionBtn" class="sidebar-button">
                <i class="fas fa-plus"></i> إضافة شرط
              </button>

              <div id="queryConditions" class="query-conditions">
                <!-- Conditions will be added here -->
              </div>
              <button id="runQueryBtn" class="sidebar-button primary-button">
                <i class="fas fa-play"></i> تنفيذ الاستعلام
              </button>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>نتائج الاستعلام</h4>
            <div id="queryResults" class="query-results">
              <div class="empty-state">
                قم بإنشاء استعلام وتنفيذه لعرض النتائج
              </div>
            </div>
          </div>
          <div class="sidebar-section">
            <h4><i class="fas fa-filter"></i> تصفية الأحياء حسب القطاع</h4>
            <div class="filter-container">
              <select
                title="sector filter select"
                id="sectorFilterSelect"
                class="sidebar-select"
              >
                <option value="">كل القطاعات</option>
                <!-- سيتم تعبئة هذه القائمة تلقائ -->
              </select>
              <button
                id="applySectorFilterBtn"
                class="sidebar-button futuristic-button"
              >
                <i class="fas fa-check"></i> تطبيق
              </button>
            </div>
            <div id="filterResults" class="filter-results"></div>
            <div class="filter-actions">
              <button
                id="exportFilteredBtn"
                class="sidebar-button futuristic-button"
              >
                <i class="fas fa-file-export"></i> تصدير النتائج المصفاة
              </button>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>تحليل بياني</h4>
            <div class="visualization-controls">
              <select title="chart type" id="chartType" class="sidebar-select">
                <option value="">اختر نوع الرسم البياني...</option>
                <option value="bar">رسم شريطي</option>
                <option value="pie">رسم دائري</option>
                <option value="line">رسم خطي</option>
                <option value="radar">رسم رادار</option>
              </select>

              <select title="chart data" id="chartData" class="sidebar-select">
                <option value="">اختر البيانات...</option>
                <option value="area">المساحة</option>
                <option value="sector">القطاع</option>
                <option value="population">عدد السكان</option>
                <option value="damage">نسبة الضرر</option>
              </select>

              <button id="generateChartBtn" class="sidebar-button">
                <i class="fas fa-chart-pie"></i> إنشاء الرسم البياني
              </button>
            </div>

            <div class="chart-container">
              <canvas id="analysisChart"></canvas>
            </div>
          </div>

          <div class="sidebar-section">
            <h4>تحليلات متقدمة</h4>
            <div class="advanced-analysis">
              <button id="densityAnalysisBtn" class="sidebar-button">
                <i class="fas fa-users"></i> تحليل الكثافة السكانية
              </button>

              <button id="infrastructureAnalysisBtn" class="sidebar-button">
                <i class="fas fa-road"></i> تحليل البنية التحتية
              </button>

              <button id="serviceAccessAnalysisBtn" class="sidebar-button">
                <i class="fas fa-hospital"></i> تحليل الوصول للخدمات
              </button>

              <button id="damageAnalysisBtn" class="sidebar-button">
                <i class="fas fa-house-damage"></i> تحليل الأضرار
              </button>
            </div>
          </div>
        </div>
      </aside>
    </div>
    <!-- Footer -->
    <footer id="mainFooter" class="no-translate" style="font-size:12px;">
      <div class="footer-content">
        <div class="copyright" style="font-size:12px;">
          <span class="copyright-text">
            ©
            <script>
              document.write(new Date().getFullYear());
            </script>
            , <span id="rightsText">Powerd by</span>
            <a
              class="companyHITech"
              href="https://www.hi-techhouse.com"
              target="_blank"
              id="companyName"
              rel="noopener"
              >HI-Tech House</a
            >
          </span>
          <!-- <img
            alt="Company Logo"
            src="assets/img/HTH.png"
            class="footer-logo"
          /> -->
        </div>
        <div class="social-icons">
          <a aria-label="Facebook" class="social-icon facebook" href="#"
            ><i class="fab fa-facebook-f"></i
          ></a>
          <a aria-label="Twitter" class="social-icon twitter" href="#"
            ><i class="fab fa-x-twitter"></i
          ></a>
          <a aria-label="Instagram" class="social-icon instagram" href="#"
            ><i class="fab fa-instagram"></i
          ></a>
          <a aria-label="LinkedIn" class="social-icon linkedin" href="#"
            ><i class="fab fa-linkedin-in"></i
          ></a>
          <a
            aria-label="WhatsApp"
            class="social-icon whatsapp"
            href="https://wa.me/966501234567"
            ><i class="fab fa-whatsapp"></i
          ></a>
        </div>
      </div>
      <!-- New centralized tabs toggle button -->
      <div class="footer-center-btn">
        <!-- Button removed since it's now in the toolbar -->
      </div>
    </footer>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- shpjs for Shapefile import -->
    <script src="https://unpkg.com/shpjs@latest/dist/shp.min.js"></script>

    <!-- Leaflet Plugins -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- Leaflet Draw JS -->
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <!-- Leaflet Measure JS -->
    <script src="https://unpkg.com/leaflet-measure/dist/leaflet-measure.js"></script>

    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Application Data & Scripts -->
    <script src="main.js"></script>
    <script src="js/service-sectors.js"></script>
    <script src="attached_assets/aleppo-data.js"></script>
    <script src="attached_assets/neighborhoods-data.js"></script>
    <script src="attached_assets/aleppo-analysis.js"></script>
    <script src="js/field-translations.js"></script>
    <script src="js/sidebar.js"></script>
    <script>
      // Add needed modifications to existing sidebar auto-close functionality
      if (typeof window.initSidebarAutoClose !== "function") {
        // Define a function to initialize sidebar auto-close if it doesn't exist yet
        window.initSidebarAutoClose = function () {
          // Auto-close functionality for sidebars
          window.showAutoCloseIndicator = function (sidebarId) {
            const sidebar = document.getElementById(sidebarId);
            if (sidebar && sidebar.getAttribute("data-pinned") === "true") {
              // Don't auto-close if pinned
              return;
            }

            const indicatorId = sidebarId + "AutoCloseIndicator";
            const indicator = document.getElementById(indicatorId);

            if (indicator) {
              indicator.classList.add("show");

              // Store the timer reference
              const timerProp =
                sidebarId === "leftSidebar"
                  ? "leftSidebarAutoCloseTimer"
                  : "rightSidebarAutoCloseTimer";

              // Clear existing timer if any
              if (window[timerProp]) {
                clearTimeout(window[timerProp]);
              }

              // Set new timer
              window[timerProp] = setTimeout(function () {
                // Check pinned state again before closing
                if (sidebar && sidebar.getAttribute("data-pinned") !== "true") {
                  indicator.classList.remove("show");
                  sidebar.classList.add("collapsed");
                }
              }, 5000); // 5 second auto-close delay
            }
          };
        };

        // Initialize
        window.initSidebarAutoClose();
      }

      // Pin sidebar functionality
      document.addEventListener("DOMContentLoaded", function () {
        const pinLeftButton = document.getElementById("pinLeftSidebar");
        const pinRightButton = document.getElementById("pinRightSidebar");
        const leftSidebar = document.getElementById("leftSidebar");
        const rightSidebar = document.getElementById("rightSidebar");

        // Set initial pinned state
        leftSidebar.setAttribute("data-pinned", "false");
        rightSidebar.setAttribute("data-pinned", "false");

        // Pin left sidebar
        pinLeftButton.addEventListener("click", function () {
          const isPinned = leftSidebar.getAttribute("data-pinned") === "true";
          leftSidebar.setAttribute("data-pinned", !isPinned);
          this.classList.toggle("active", !isPinned);

          // If pinned, hide auto-close indicator
          const autoCloseIndicator = document.getElementById(
            "leftSidebarAutoCloseIndicator"
          );
          if (autoCloseIndicator) {
            if (!isPinned) {
              autoCloseIndicator.classList.remove("show");
              // Clear any auto-close timers if they exist
              if (window.leftSidebarAutoCloseTimer) {
                clearTimeout(window.leftSidebarAutoCloseTimer);
              }
            }
          }
        });

        // Pin right sidebar
        pinRightButton.addEventListener("click", function () {
          const isPinned = rightSidebar.getAttribute("data-pinned") === "true";
          rightSidebar.setAttribute("data-pinned", !isPinned);
          this.classList.toggle("active", !isPinned);

          // If pinned, hide auto-close indicator
          const autoCloseIndicator = document.getElementById(
            "rightSidebarAutoCloseIndicator"
          );
          if (autoCloseIndicator) {
            if (!isPinned) {
              autoCloseIndicator.classList.remove("show");
              // Clear any auto-close timers if they exist
              if (window.rightSidebarAutoCloseTimer) {
                clearTimeout(window.rightSidebarAutoCloseTimer);
              }
            }
          }
        });

        // Override existing auto-close functionality
        const originalShowAutoCloseIndicator = window.showAutoCloseIndicator;
        if (originalShowAutoCloseIndicator) {
          window.showAutoCloseIndicator = function (sidebarId) {
            const sidebar = document.getElementById(sidebarId);
            if (sidebar && sidebar.getAttribute("data-pinned") === "true") {
              // Don't auto-close if pinned
              return;
            }
            // Otherwise call original function
            originalShowAutoCloseIndicator(sidebarId);
          };
        }
      });
    </script>
    <script src="js/map.js"></script>
    <script src="js/query.js"></script>
    <script src="js/hydraulic-billing.js"></script>
    <script src="js/import-export.js"></script>
    <script src="js/features.js"></script>
    <script src="js/tabs2.js"></script>
    <script src="js/info-panel-formatter.js"></script>
    <script>
      // Fix for white space issue when clicking on the map
      document.addEventListener("click", function (e) {
        if (e.target && (e.target.id === "map" || e.target.closest("#map"))) {
          setTimeout(function () {
            if (window.map && typeof window.map.invalidateSize === "function") {
              window.map.invalidateSize(true);
            }
          }, 100);
        }
      });

      // Application translations for Arabic and English
      const translations = {
        ar: {
          title: "نظام الإدارة الحضرية لمدينة حلب",
          settingsText: "إعدادات الحساب",
          logoutText: "تسجيل الخروج",
          rightsText: "Powerd by",
          companyName: "HI-Tech House",
          // Info panel buttons
          cancelChanges: "إلغاء التعديلات",
          saveChanges: "حفظ التغييرات",
          nextTab: "التالي",
          saveAllData: "تحديث جميع البيانات",
          saveAllWarning: "سيتم حفظ جميع التغييرات بشكل دائم. هل أنت متأكد من المتابعة؟",
          continue: "متابعة",
          cancel: "إلغاء",
          successMessage: "تم تحديث جميع البيانات بنجاح!",

          // Tab names
          tabs: {
            "التزود الأساسي": "التزود الأساسي",
            "الخدمة الصحية المركزية": "الخدمة الصحية المركزية",
            "البنية التحتية": "البنية التحتية",
            "الخدمات الإدارية": "الخدمات الإدارية",
            "الخدمات الأخرى": "الخدمات الأخرى",
            "قسم النظافة": "قسم النظافة",
            "المنشآت والفعاليات الاقتصادية الأساسية": "المنشآت والفعاليات الاقتصادية الأساسية",
            "الاقتصاد الزراعي": "الاقتصاد الزراعي",
            "تحليل علاقة الشركاء الفاعلين": "تحليل علاقة الشركاء الفاعلين",
          },


          // Sidebar labels
          sidebar: {
            layersManagement: "إدارة الطبقات",
            baseMaps: "الخرائط الأساسية",
            openStreetMap: "خريطة الشارع المفتوحة",
            satellite: "صور الأقمار الصناعية",
            terrain: "التضاريس",
            layers: "الطبقات",
            neighborhoods: "الأحياء",
            serviceSectors: "دوائر الخدمات",
            importExport: "تصدير / استيراد",
            importLayer: "استيراد طبقة",
            exportLayer: "تصدير طبقة",
            exportFormat: "صيغة التصدير",
            symbolsColors: "الرموز والألوان",
            chooseLayer: "اختر طبقة...",
            color: "اللون:",
            transparency: "الشفافية:",
            lineWeight: "سمك الخط:",
            apply: "تطبيق",
          },
          // Right sidebar
          analysisQueries: {
            title: "التحليلات والاستعلامات",
            queryBuilder: "منشئ الاستعلامات",
            chooseLayer: "اختر طبقة...",
            chooseField: "اختر حقل...",
            chooseOperation: "اختر العملية...",
            enterValue: "أدخل القيمة",
            addCondition: "إضافة شرط",
            runQuery: "تنفيذ الاستعلام",
            queryResults: "نتائج الاستعلام",
            createQueryMessage: "قم بإنشاء استعلام وتنفيذه لعرض النتائج",
            filterBySection: "تصفية الأحياء حسب القطاع",
            allSectors: "كل القطاعات",
            apply: "تطبيق",
            exportFilteredResults: "تصدير النتائج المصفاة",
            chartAnalysis: "تحليل بياني",
            chooseChartType: "اختر نوع الرسم البياني...",
            barChart: "رسم شريطي",
            pieChart: "رسم دائري",
            lineChart: "رسم خطي",
            radarChart: "رسم رادار",
            chooseData: "اختر البيانات...",
            area: "المساحة",
            sector: "القطاع",
            population: "عدد السكان",
            damage: "نسبة الضرر",
            generateChart: "إنشاء الرسم البياني",
            advancedAnalysis: "تحليلات متقدمة",
            populationDensity: "تحليل الكثافة السكانية",
            infrastructure: "تحليل البنية التحتية",
            serviceAccess: "تحليل الوصول للخدمات",
            damageAnalysis: "تحليل الأضرار",
          },
          // Map controls
          mapControls: {
            layers: "الطبقات",
          },
        },
        en: {
          title: "Urban Management System for Aleppo",
          settingsText: "Account Settings",
          logoutText: "Logout",
          rightsText: "Powerd by",
          companyName: "Hi-Tech House",
          // Info panel buttons
          cancelChanges: "Cancel Changes",
          saveChanges: "Save Changes",
          nextTab: "Next",
          saveAllData: "Update All Data",
          saveAllWarning: "All changes will be saved permanently. Are you sure you want to continue?",
          continue: "Continue",
          cancel: "Cancel",
          successMessage: "All data saved successfully!",
          // Tab names
          tabs: {
            "التزود الأساسي": "Basic supplies",
            "الخدمة الصحية المركزية": "Central Health Service",
            "البنية التحتية": "Infrastructure",
            "الخدمات الإدارية": "Administrative Services",
            "الخدمات الأخرى": "Other Services",
            "قسم النظافة": "Cleanliness Department",
            "المنشآت والفعاليات الاقتصادية الأساسية":
              "Basic Economic Facilities and Activities",
            "الاقتصاد الزراعي": "Agricultural Economy",
            "تحليل علاقة الشركاء الفاعلين": "Stakeholder Relationship Analysis",
          },
          // Sidebar labels
          sidebar: {
            layersManagement: "Layers Management",
            baseMaps: "Base Maps",
            openStreetMap: "OpenStreetMap",
            satellite: "Satellite Imagery",
            terrain: "Terrain",
            layers: "Layers",
            neighborhoods: "Neighborhoods",
            serviceSectors: "Service Sectors",
            importExport: "Import / Export",
            importLayer: "Import Layer",
            exportLayer: "Export Layer",
            exportFormat: "Export Format",
            symbolsColors: "Symbols and Colors",
            chooseLayer: "Choose Layer...",
            color: "Color:",
            transparency: "Transparency:",
            lineWeight: "Line Weight:",
            apply: "Apply",
          },
          // Right sidebar
          analysisQueries: {
            title: "Analysis and Queries",
            queryBuilder: "Query Builder",
            chooseLayer: "Choose Layer...",
            chooseField: "Choose Field...",
            chooseOperation: "Choose Operation...",
            enterValue: "Enter Value",
            addCondition: "Add Condition",
            runQuery: "Run Query",
            queryResults: "Query Results",
            createQueryMessage: "Create and run a query to view results",
            filterBySection: "Filter Neighborhoods by Sector",
            allSectors: "All Sectors",
            apply: "Apply",
            exportFilteredResults: "Export Filtered Results",
            chartAnalysis: "Chart Analysis",
            chooseChartType: "Choose Chart Type...",
            barChart: "Bar Chart",
            pieChart: "Pie Chart",
            lineChart: "Line Chart",
            radarChart: "Radar Chart",
            chooseData: "Choose Data...",
            area: "Area",
            sector: "Sector",
            population: "Population",
            damage: "Damage Percentage",
            generateChart: "Generate Chart",
            advancedAnalysis: "Advanced Analysis",
            populationDensity: "Population Density Analysis",
            infrastructure: "Infrastructure Analysis",
            serviceAccess: "Service Access Analysis",
            damageAnalysis: "Damage Analysis",
          },
          // Map controls
          mapControls: {
            layers: "Layers",
          },
        },
      };

      // Make translations available globally
      window.translations = translations;

      function toggleLanguage() {
        // Switch between Arabic and English
        const currentLang = document.documentElement.lang || "ar";
        const newLang = currentLang === "ar" ? "en" : "ar";
        switchLanguage(newLang);

        // Update language toggle button text
        const langToggleBtn = document.getElementById("langToggleBtn");
        if (langToggleBtn) {
          langToggleBtn.textContent = newLang.toUpperCase();
        }

        // Save selected language to local storage
        localStorage.setItem("selectedLanguage", newLang);
      }

      function switchLanguage(lang) {
        // Change page direction based on language
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";

        // Apply fixed direction to no-translate elements
        document.querySelectorAll(".no-translate").forEach((element) => {
          // Keep header and footer with fixed direction regardless of language
          element.style.direction = "rtl"; // Always keep RTL for header and footer

          // Ensure the layout doesn't change when switching languages
          if (element.id === "mainHeader") {
            // Fix header elements
            const rightLogos = element.querySelector(
              ".header-logos.right-logos"
            );
            const leftControls = element.querySelector("div:first-child");
            const title = element.querySelector(".header-title");

            if (rightLogos) rightLogos.style.right = "20px";
            if (leftControls) leftControls.style.left = "20px";
            if (title) {
              title.style.left = "50%";
              title.style.transform = "translateX(-50%)";
            }
          } else if (element.id === "mainFooter") {
            // Fix footer elements
            const copyright = element.querySelector(".copyright");
            const socialIcons = element.querySelector(".social-icons");

            if (copyright) copyright.style.left = "20px";
            if (socialIcons) socialIcons.style.right = "20px";
          }
        });

        // Ensure map-toolbar and tabs-container maintain RTL direction
        document
          .querySelectorAll(".map-toolbar, .tabs-container")
          .forEach((element) => {
            element.style.direction = "rtl";
          });

        // Get translation object for selected language
        const t = translations[lang];
        //document.title = t.title;

        // Skip translation for elements with no-translate class
        const noTranslateElements = document.querySelectorAll(".no-translate");

        // update menu - only if not in a no-translate container
        const settingsText = document.getElementById("settingsText");
        const logoutText = document.getElementById("logoutText");

        const rightsText = document.getElementById("rightsText");
        const companyName = document.getElementById("companyName");

        const titleAr = document.querySelector(".title-ar");
        const titleEn = document.querySelector(".title-en");

        if (t.tabs) {
          document.querySelectorAll(".tab-button").forEach((button) => {
            if (isInNoTranslateContainer(button)) return;

            const tabId = button.getAttribute("data-tab");
            const tabSpan = button.querySelector("span:not(.tab-close)");
            if (tabSpan && tabId && t.tabs[tabId]) {
              tabSpan.textContent = t.tabs[tabId];
            }
          });
        }

        // Update layers text in map controls
        const layersToggleAfter = document.querySelector(
          ".leaflet-control-layers-toggle::after"
        );
        if (
          layersToggleAfter &&
          t.mapControls &&
          t.mapControls.layers &&
          !isInNoTranslateContainer(layersToggleAfter)
        ) {
          document.documentElement.style.setProperty(
            "--layers-text",
            `"${t.mapControls.layers}"`
          );
        }

        // update sidebar elements
        if (t.sidebar) {
          // sidebar titles
          const layersManagementTitle = document.querySelector(
            "#leftSidebar .sidebar-header h3"
          );
          if (
            layersManagementTitle &&
            !isInNoTranslateContainer(layersManagementTitle)
          ) {
            layersManagementTitle.textContent = t.sidebar.layersManagement;
          }

          // base maps title
          const baseMapsTitle = document.querySelector(
            ".sidebar-section-title"
          );
          if (baseMapsTitle) {
            const iconSpan = baseMapsTitle.querySelector("i");
            baseMapsTitle.innerHTML = "";
            if (iconSpan) baseMapsTitle.appendChild(iconSpan);
            baseMapsTitle.appendChild(
              document.createTextNode(t.sidebar.baseMaps)
            );
          }

          // base maps options
          const osmLabel = document.querySelector('label[for="osm"]');
          const satelliteLabel = document.querySelector(
            'label[for="satellite"]'
          );
          const terrainLabel = document.querySelector('label[for="terrain"]');

          if (osmLabel) osmLabel.textContent = t.sidebar.openStreetMap;
          if (satelliteLabel) satelliteLabel.textContent = t.sidebar.satellite;
          if (terrainLabel) terrainLabel.textContent = t.sidebar.terrain;

          // layers title
          const layersTitle = document.querySelector(
            ".sidebar-section h4:not(.sidebar-section-title)"
          );
          if (layersTitle) layersTitle.textContent = t.sidebar.layers;

          // neighborhoods label
          const neighborhoodsLabel = document.querySelector(
            'label[for="layer-neighborhoods"]'
          );
          const serviceSectorsLabel = document.querySelector(
            'label[for="layer-service-sectors"]'
          );

          if (neighborhoodsLabel)
            neighborhoodsLabel.textContent = t.sidebar.neighborhoods;
          if (serviceSectorsLabel)
            serviceSectorsLabel.textContent = t.sidebar.serviceSectors;

          // import/export title
          const importExportTitle = document.querySelector(
            ".sidebar-section:nth-child(3) h4"
          );
          if (importExportTitle)
            importExportTitle.textContent = t.sidebar.importExport;

          const importLayerBtn = document.getElementById("importLayerBtn");
          const exportLayerBtn = document.getElementById("exportLayerBtn");
          const exportFormatLabel = document.querySelector(
            'label[for="exportFormat"]'
          );

          if (importLayerBtn) {
            const iconElement = importLayerBtn.querySelector("i");
            importLayerBtn.innerHTML = "";
            if (iconElement) importLayerBtn.appendChild(iconElement);
            importLayerBtn.appendChild(
              document.createTextNode(" " + t.sidebar.importLayer)
            );
          }

          if (exportLayerBtn) {
            const iconElement = exportLayerBtn.querySelector("i");
            exportLayerBtn.innerHTML = "";
            if (iconElement) exportLayerBtn.appendChild(iconElement);
            exportLayerBtn.appendChild(
              document.createTextNode(" " + t.sidebar.exportLayer)
            );
          }

          if (exportFormatLabel)
            exportFormatLabel.textContent = t.sidebar.exportFormat + ":";

          // symbols and colors title
          const symbolsColorsTitle = document.querySelector(
            ".sidebar-section:nth-child(4) h4"
          );
          if (symbolsColorsTitle)
            symbolsColorsTitle.textContent = t.sidebar.symbolsColors;

          // update layer style options
          const layerStyleSelect = document.getElementById("layerStyleSelect");
          if (layerStyleSelect) {
            const firstOption =
              layerStyleSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = t.sidebar.chooseLayer;

            const neighborhoodsOption = layerStyleSelect.querySelector(
              "option[value='neighborhoods']"
            );
            const serviceSectorsOption = layerStyleSelect.querySelector(
              "option[value='service-sectors']"
            );

            if (neighborhoodsOption)
              neighborhoodsOption.textContent = t.sidebar.neighborhoods;
            if (serviceSectorsOption)
              serviceSectorsOption.textContent = t.sidebar.serviceSectors;
          }

          // update style options
          const colorLabel = document.querySelector(
            ".style-option:nth-child(1) label"
          );
          const opacityLabel = document.querySelector(
            ".style-option:nth-child(2) label"
          );
          const lineWeightLabel = document.querySelector(
            ".style-option:nth-child(3) label"
          );
          const applyStyleBtn = document.getElementById("applyStyleBtn");

          if (colorLabel) colorLabel.textContent = t.sidebar.color;
          if (opacityLabel) opacityLabel.textContent = t.sidebar.transparency;
          if (lineWeightLabel)
            lineWeightLabel.textContent = t.sidebar.lineWeight;

          if (applyStyleBtn) {
            const iconElement = applyStyleBtn.querySelector("i");
            applyStyleBtn.innerHTML = "";
            if (iconElement) applyStyleBtn.appendChild(iconElement);
            applyStyleBtn.appendChild(
              document.createTextNode(" " + t.sidebar.apply)
            );
          }
        }

        // update sidebar elements
        if (t.analysisQueries) {
          const aq = t.analysisQueries;

          // sidebar title
          const rightSidebarTitle = document.querySelector(
            "#rightSidebar .sidebar-header h3"
          );
          if (rightSidebarTitle) rightSidebarTitle.textContent = aq.title;

          // query builder title
          const queryBuilderTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(1) h4"
          );
          if (queryBuilderTitle)
            queryBuilderTitle.textContent = aq.queryBuilder;

          // query options
          const queryTableSelect = document.getElementById("queryTableSelect");
          const queryFieldSelect = document.getElementById("queryFieldSelect");
          const queryOperatorSelect = document.getElementById(
            "queryOperatorSelect"
          );
          const queryValueInput = document.getElementById("queryValueInput");

          if (queryTableSelect) {
            const firstOption =
              queryTableSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.chooseLayer;
          }

          if (queryFieldSelect) {
            const firstOption =
              queryFieldSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.chooseField;
          }

          if (queryOperatorSelect) {
            const firstOption =
              queryOperatorSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.chooseOperation;
          }

          if (queryValueInput) queryValueInput.placeholder = aq.enterValue;

          // query buttons
          const addConditionBtn = document.getElementById("addConditionBtn");
          const runQueryBtn = document.getElementById("runQueryBtn");

          if (addConditionBtn) {
            const iconElement = addConditionBtn.querySelector("i");
            addConditionBtn.innerHTML = "";
            if (iconElement) addConditionBtn.appendChild(iconElement);
            addConditionBtn.appendChild(
              document.createTextNode(" " + aq.addCondition)
            );
          }

          if (runQueryBtn) {
            const iconElement = runQueryBtn.querySelector("i");
            runQueryBtn.innerHTML = "";
            if (iconElement) runQueryBtn.appendChild(iconElement);
            runQueryBtn.appendChild(document.createTextNode(" " + aq.runQuery));
          }

          // query results title
          const queryResultsTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(2) h4"
          );
          if (queryResultsTitle)
            queryResultsTitle.textContent = aq.queryResults;

          // query results empty state
          const emptyState = document.querySelector(
            ".query-results .empty-state"
          );
          if (emptyState) emptyState.textContent = aq.createQueryMessage;

          // filter title
          const filterTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(3) h4"
          );
          if (filterTitle) {
            const iconElement = filterTitle.querySelector("i");
            filterTitle.innerHTML = "";
            if (iconElement) filterTitle.appendChild(iconElement);
            filterTitle.appendChild(
              document.createTextNode(" " + aq.filterBySection)
            );
          }

          // filter options
          const sectorFilterSelect =
            document.getElementById("sectorFilterSelect");
          const applySectorFilterBtn = document.getElementById(
            "applySectorFilterBtn"
          );
          const exportFilteredBtn =
            document.getElementById("exportFilteredBtn");

          if (sectorFilterSelect) {
            const firstOption =
              sectorFilterSelect.querySelector("option[value='']");
            if (firstOption) firstOption.textContent = aq.allSectors;
          }

          if (applySectorFilterBtn) {
            const iconElement = applySectorFilterBtn.querySelector("i");
            applySectorFilterBtn.innerHTML = "";
            if (iconElement) applySectorFilterBtn.appendChild(iconElement);
            applySectorFilterBtn.appendChild(
              document.createTextNode(" " + aq.apply)
            );
          }

          if (exportFilteredBtn) {
            const iconElement = exportFilteredBtn.querySelector("i");
            exportFilteredBtn.innerHTML = "";
            if (iconElement) exportFilteredBtn.appendChild(iconElement);
            exportFilteredBtn.appendChild(
              document.createTextNode(" " + aq.exportFilteredResults)
            );
          }

          const chartAnalysisTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(4) h4"
          );
          if (chartAnalysisTitle)
            chartAnalysisTitle.textContent = aq.chartAnalysis;

          const chartType = document.getElementById("chartType");
          const chartData = document.getElementById("chartData");
          const generateChartBtn = document.getElementById("generateChartBtn");

          if (chartType) {
            const options = chartType.querySelectorAll("option");
            if (options.length > 0) {
              options[0].textContent = aq.chooseChartType;
              if (options.length > 1) options[1].textContent = aq.barChart;
              if (options.length > 2) options[2].textContent = aq.pieChart;
              if (options.length > 3) options[3].textContent = aq.lineChart;
              if (options.length > 4) options[4].textContent = aq.radarChart;
            }
          }

          if (chartData) {
            const options = chartData.querySelectorAll("option");
            if (options.length > 0) {
              options[0].textContent = aq.chooseData;
              if (options.length > 1) options[1].textContent = aq.area;
              if (options.length > 2) options[2].textContent = aq.sector;
              if (options.length > 3) options[3].textContent = aq.population;
              if (options.length > 4) options[4].textContent = aq.damage;
            }
          }

          if (generateChartBtn) {
            const iconElement = generateChartBtn.querySelector("i");
            generateChartBtn.innerHTML = "";
            if (iconElement) generateChartBtn.appendChild(iconElement);
            generateChartBtn.appendChild(
              document.createTextNode(" " + aq.generateChart)
            );
          }

          const advancedAnalysisTitle = document.querySelector(
            "#rightSidebar .sidebar-section:nth-child(5) h4"
          );
          if (advancedAnalysisTitle)
            advancedAnalysisTitle.textContent = aq.advancedAnalysis;

          const densityAnalysisBtn =
            document.getElementById("densityAnalysisBtn");
          const infrastructureAnalysisBtn = document.getElementById(
            "infrastructureAnalysisBtn"
          );
          const serviceAccessAnalysisBtn = document.getElementById(
            "serviceAccessAnalysisBtn"
          );
          const damageAnalysisBtn =
            document.getElementById("damageAnalysisBtn");

          if (densityAnalysisBtn) {
            const iconElement = densityAnalysisBtn.querySelector("i");
            densityAnalysisBtn.innerHTML = "";
            if (iconElement) densityAnalysisBtn.appendChild(iconElement);
            densityAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.populationDensity)
            );
          }

          if (infrastructureAnalysisBtn) {
            const iconElement = infrastructureAnalysisBtn.querySelector("i");
            infrastructureAnalysisBtn.innerHTML = "";
            if (iconElement) infrastructureAnalysisBtn.appendChild(iconElement);
            infrastructureAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.infrastructure)
            );
          }

          if (serviceAccessAnalysisBtn) {
            const iconElement = serviceAccessAnalysisBtn.querySelector("i");
            serviceAccessAnalysisBtn.innerHTML = "";
            if (iconElement) serviceAccessAnalysisBtn.appendChild(iconElement);
            serviceAccessAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.serviceAccess)
            );
          }

          if (damageAnalysisBtn) {
            const iconElement = damageAnalysisBtn.querySelector("i");
            damageAnalysisBtn.innerHTML = "";
            if (iconElement) damageAnalysisBtn.appendChild(iconElement);
            damageAnalysisBtn.appendChild(
              document.createTextNode(" " + aq.damageAnalysis)
            );
          }
        }

        const infoPanel = document.getElementById("info-panel");
        if (infoPanel) {
          // Update buttons text
          const cancelChangesBtn = document.getElementById("cancel-changes");
          const saveChangesBtn = document.getElementById("save-changes");

          if (cancelChangesBtn && t.cancelChanges) {
            cancelChangesBtn.textContent = t.cancelChanges;
          }

          if (saveChangesBtn && t.saveChanges) {
            saveChangesBtn.textContent = t.saveChanges;
          }

          // Refresh panel content if it's open
          if (infoPanel.classList.contains("show")) {
            const activeTab = document.querySelector(".tab-button.active");
            if (activeTab) {
              const tabId = activeTab.getAttribute("data-tab");
              if (tabId && selectedNeighborhoodId) {
                renderInfoPanel(tabId, selectedNeighborhoodId);
              }
            }
          }
        }
      }

      // Helper function to check if an element is inside a no-translate container
      function isInNoTranslateContainer(element) {
        let parent = element.parentElement;
        while (parent) {
          if (parent.classList && parent.classList.contains("no-translate")) {
            return true;
          }
          parent = parent.parentElement;
        }
        return false;
      }

      function toggleMenu() {
        const menu = document.getElementById("menuDropdown");
        menu.style.display = menu.style.display === "block" ? "none" : "block";
      }

      document.addEventListener("click", function (event) {
        const dropdown = document.querySelector(".menu-dropdown");
        if (dropdown && !dropdown.contains(event.target)) {
          document.getElementById("menuDropdown").style.display = "none";
        }
      });

      function logout() {
        window.location.href = "../index.html";
      }

      document.addEventListener("DOMContentLoaded", function () {
        localStorage.removeItem("selectedLanguage");
        localStorage.setItem("selectedLanguage", "ar");

        // Apply fixed styles to header and footer to prevent layout shifts
        document.querySelectorAll(".no-translate").forEach((element) => {
          element.style.direction = "rtl";

          // Make sure both titles are visible in the header
          if (element.id === "mainHeader") {
            const titleAr = element.querySelector(".title-ar");
            const titleEn = element.querySelector(".title-en");

            if (titleAr) titleAr.style.display = "block";
            if (titleEn) titleEn.style.display = "block";
          }
        });

        switchLanguage("ar");

        const langToggleBtn = document.getElementById("langToggleBtn");
        if (langToggleBtn) {
          langToggleBtn.textContent = "AR";
        }

        document.documentElement.dir = "rtl";
        document.documentElement.lang = "ar";
      });

      document.addEventListener("DOMContentLoaded", function () {
        // Service Sectors Layer Checkbox
        const serviceSectorsCheckbox = document.getElementById(
          "layer-service-sectors"
        );
        if (serviceSectorsCheckbox) {
          serviceSectorsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("service-sectors", this.checked);
            }
          });
        }

        // Neighborhoods Layer Checkbox (optional, for consistency)
        const neighborhoodsCheckbox = document.getElementById(
          "layer-neighborhoods"
        );
        if (neighborhoodsCheckbox) {
          neighborhoodsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("neighborhoods", this.checked);
            }
          });
        }
      });

      function toggleLayersPanel() {
        var modal = document.getElementById("customLayersModal");
        if (modal.classList.contains("open")) {
          modal.classList.remove("open");
        } else {
          modal.classList.add("open");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Service Sectors Layer Checkbox
        const serviceSectorsCheckbox = document.getElementById(
          "layer-service-sectors"
        );
        if (serviceSectorsCheckbox) {
          serviceSectorsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("service-sectors", this.checked);
            }
          });
        }

        // Neighborhoods Layer Checkbox (optional, for consistency)
        const neighborhoodsCheckbox = document.getElementById(
          "layer-neighborhoods"
        );
        if (neighborhoodsCheckbox) {
          neighborhoodsCheckbox.addEventListener("change", function () {
            if (window.mapLayerToggle) {
              window.mapLayerToggle("neighborhoods", this.checked);
            }
          });
        }
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var tabs = document.querySelector(".tabs-container");
        if (tabs) {
          tabs.classList.remove("collapsed");
          // initial hidden state with motion effects
          tabs.classList.add("hidden");
          tabs.style.display = "none";
          tabs.style.zIndex = "3000";

          // Add event listener for the tabs toggle button (now in the toolbar)
          const tabsToggleBtn = document.getElementById("tabsToggleBtn");
          if (tabsToggleBtn) {
            // Remove any old classes and add toolbar button styling
            tabsToggleBtn.className = "";

            tabsToggleBtn.addEventListener("click", function () {
              if (tabs) {
                if (
                  tabs.classList.contains("hidden") ||
                  tabs.style.display === "none"
                ) {
                  // show tabs with motion effects
                  tabs.style.display = "flex";
                  // wait for the transition to apply
                  setTimeout(function () {
                    tabs.classList.remove("hidden");
                    tabs.classList.add("visible");
                  }, 10);
                } else {
                  // hide tabs with motion effects
                  tabs.classList.remove("visible");
                  tabs.classList.add("hidden");
                  // wait for the transition to apply
                  setTimeout(function () {
                    tabs.style.display = "none";
                  }, 400); // نفس وقت الـ transition
                }
              }
            });
          }
        }
      });
    </script>

    <!-- Fix for map.js null element error -->
    <script>
      // This script runs before other scripts to patch the addEventListener method
      document.addEventListener("DOMContentLoaded", function () {
        // Create a safety wrapper for addEventListener
        const originalAddEventListener = Element.prototype.addEventListener;

        // Override with a version that checks for null
        Element.prototype.addEventListener = function () {
          if (this) {
            return originalAddEventListener.apply(this, arguments);
          }
        };

        // Fix for specific error in map.js:1861
        // Create any elements that might be expected by map.js but don't exist
        if (!document.getElementById("layer-neighborhoods")) {
          const dummyElement = document.createElement("input");
          dummyElement.type = "checkbox";
          dummyElement.id = "layer-neighborhoods";
          dummyElement.style.display = "none";
          dummyElement.checked = true;
          document.body.appendChild(dummyElement);
        }

        if (!document.getElementById("layer-service-sectors")) {
          const dummyElement = document.createElement("input");
          dummyElement.type = "checkbox";
          dummyElement.id = "layer-service-sectors";
          dummyElement.style.display = "none";
          dummyElement.checked = true;
          document.body.appendChild(dummyElement);
        }
      });
    </script>

    <!-- Completely independent basemap button and gallery -->
    <div
      id="independent-basemap-button"
      style="
        position: fixed;
        left: 20px;
        bottom: 60px;
        width: 50px;
        height: 50px;
        background-color: #ff5722;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 999;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        font-size: 24px;
      "
    >
      <i class="fas fa-map" style="pointer-events: none"></i>
    </div>

    <div
      id="independent-basemap-gallery"
      style="
        display: none;
        position: fixed;
        left: 50px;
        bottom: 130px;
        background: white;
        border-radius: 10px;
        padding: 15px;
        z-index: 999;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
        width: 250px;
      "
    >
      <div style="font-weight: bold; margin-bottom: 10px; text-align: center">
        اختر الخريطة الأساسية
      </div>
      <div
        style="
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 10px;
        "
      >
        <div
          class="independent-basemap-option"
          data-type="osm"
          style="
            width: 100px;
            height: 80px;
            background-color: #e8e8e8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid #ddd;
            flex-direction: column;
          "
        >
          <div style="font-size: 24px; color: #666">
            <i class="fas fa-map"></i>
          </div>
          <div style="font-size: 12px; margin-top: 5px; text-align: center">
            خريطة الشارع
          </div>
        </div>

        <div
          class="independent-basemap-option"
          data-type="satellite"
          style="
            width: 100px;
            height: 80px;
            background-color: #333;
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid #ddd;
            flex-direction: column;
          "
        >
          <div style="font-size: 24px"><i class="fas fa-satellite"></i></div>
          <div style="font-size: 12px; margin-top: 5px; text-align: center">
            أقمار صناعية
          </div>
        </div>

        <div
          class="independent-basemap-option"
          data-type="terrain"
          style="
            width: 100px;
            height: 80px;
            background-color: #c5e8c5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid #ddd;
            flex-direction: column;
          "
        >
          <div style="font-size: 24px; color: #4a6741">
            <i class="fas fa-mountain"></i>
          </div>
          <div style="font-size: 12px; margin-top: 5px; text-align: center">
            تضاريس
          </div>
        </div>

        <div
          class="independent-basemap-option"
          data-type="dark"
          style="
            width: 100px;
            height: 80px;
            background-color: #121212;
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid #ddd;
            flex-direction: column;
          "
        >
          <div style="font-size: 24px"><i class="fas fa-moon"></i></div>
          <div style="font-size: 12px; margin-top: 5px; text-align: center">
            داكن
          </div>
        </div>
      </div>
    </div>

    <script>
      // Simple direct script for the independent basemap elements
      window.addEventListener("load", function () {
        var button = document.getElementById("independent-basemap-button");
        var gallery = document.getElementById("independent-basemap-gallery");

        if (button && gallery) {
          // Handle button click
          button.onclick = function () {
            if (gallery.style.display === "none") {
              gallery.style.display = "block";
            } else {
              gallery.style.display = "none";
            }
          };

          // Handle clicking outside gallery
          document.addEventListener("click", function (e) {
            if (
              e.target !== button &&
              !gallery.contains(e.target) &&
              gallery.style.display !== "none"
            ) {
              gallery.style.display = "none";
            }
          });

          // Handle basemap options
          var options = document.getElementsByClassName(
            "independent-basemap-option"
          );
          for (var i = 0; i < options.length; i++) {
            options[i].onclick = function () {
              // Clear selected state from all options
              for (var j = 0; j < options.length; j++) {
                options[j].style.border = "3px solid #ddd";
              }

              // Mark this option as selected
              this.style.border = "3px solid #2196F3";

              // Get basemap type
              var type = this.getAttribute("data-type");
              console.log("Selected basemap:", type);

              // Change map if possible
              if (window.map) {
                try {
                  // Remove existing basemap layers
                  window.map.eachLayer(function (layer) {
                    if (layer._url && layer._url.includes("tile")) {
                      window.map.removeLayer(layer);
                    }
                  });

                  // Add new basemap
                  if (type === "osm") {
                    L.tileLayer(
                      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                      {
                        maxZoom: 19,
                      }
                    ).addTo(window.map);
                  } else if (type === "satellite") {
                    L.tileLayer(
                      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
                      {
                        maxZoom: 19,
                      }
                    ).addTo(window.map);
                  } else if (type === "terrain") {
                    L.tileLayer(
                      "https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.png",
                      {
                        maxZoom: 18,
                      }
                    ).addTo(window.map);
                  } else if (type === "dark") {
                    L.tileLayer(
                      "https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}{r}.png",
                      {
                        maxZoom: 19,
                      }
                    ).addTo(window.map);
                  }
                } catch (e) {
                  console.error("Error changing basemap:", e);
                }
              }

              // Close gallery
              gallery.style.display = "none";
            };
          }
        }
      });
    </script>

<script>
  // عند إظهار info-panel، أظهر tabs تلقائياً
  (function(){
    var tryPatch = function() {
      if (window.renderInfoPanel && !window.renderInfoPanel._tabsAutoShowPatched) {
        var origRenderInfoPanel = window.renderInfoPanel;
        window.renderInfoPanel = function(tabId, neighborhoodId) {
          // أظهر التبويبات إذا كانت مخفية
          var tabs = document.querySelector('.tabs-container');
          if (tabs && (tabs.classList.contains('hidden') || tabs.style.display === 'none')) {
            tabs.style.display = 'flex';
            setTimeout(function(){
              tabs.classList.remove('hidden');
              tabs.classList.add('visible');
            }, 10);
          }
          // نفذ الدالة الأصلية
          return origRenderInfoPanel.apply(this, arguments);
        };
        window.renderInfoPanel._tabsAutoShowPatched = true;
      }
    };
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      setTimeout(tryPatch, 0);
    } else {
      document.addEventListener('DOMContentLoaded', tryPatch);
    }
  })();
</script>

  </body>
</html>
